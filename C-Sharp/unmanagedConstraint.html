<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.4">
<title data-react-helmet="true">Unmanaged constraint | Learning Collection Knowledge Base</title><meta data-react-helmet="true" property="og:url" content="https://RobinTTY.github.io/LearningCollection/C-Sharp/unmanagedConstraint"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Unmanaged constraint | Learning Collection Knowledge Base"><meta data-react-helmet="true" name="description" content="The unmanaged constraint feature will give language enforcement to the class of types known as &quot;unmanaged types&quot; in the C# language spec. This is defined in section 18.2 as a type which is not a reference type and doesn&#x27;t contain reference type fields at any level of nesting."><meta data-react-helmet="true" property="og:description" content="The unmanaged constraint feature will give language enforcement to the class of types known as &quot;unmanaged types&quot; in the C# language spec. This is defined in section 18.2 as a type which is not a reference type and doesn&#x27;t contain reference type fields at any level of nesting."><link data-react-helmet="true" rel="shortcut icon" href="/LearningCollection/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://RobinTTY.github.io/LearningCollection/C-Sharp/unmanagedConstraint"><link data-react-helmet="true" rel="alternate" href="https://RobinTTY.github.io/LearningCollection/C-Sharp/unmanagedConstraint" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://RobinTTY.github.io/LearningCollection/C-Sharp/unmanagedConstraint" hreflang="x-default"><link rel="stylesheet" href="/LearningCollection/assets/css/styles.bd168e87.css">
<link rel="preload" href="/LearningCollection/assets/js/runtime~main.7d13e80f.js" as="script">
<link rel="preload" href="/LearningCollection/assets/js/main.f5886633.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/LearningCollection/"><img src="/LearningCollection/img/logo.svg" alt="My Site Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/LearningCollection/img/logo.svg" alt="My Site Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Learning Collection</b></a><a class="navbar__item navbar__link navbar__link--active" href="/LearningCollection/">Docs</a></div><div class="navbar__items navbar__items--right"><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button" title="Scroll to top"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">C-Sharp</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/LearningCollection/C-Sharp/aspnet">ASP.NET</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/LearningCollection/C-Sharp/assemblyClass">Assembly Class</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/LearningCollection/C-Sharp/asyncProgramming">Asynchronous Programming</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/LearningCollection/C-Sharp/closures">Closures</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/LearningCollection/C-Sharp/netFramework">.NET Framework</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/LearningCollection/C-Sharp/generics">Generics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/LearningCollection/C-Sharp/ienumerable">IEnumerable</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/LearningCollection/C-Sharp/manResetEvent">ManualResetEvent</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/LearningCollection/C-Sharp/memVsFileStream">Memory Stream vs FileStream</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/LearningCollection/C-Sharp/netstandardVsNetcoreVsUwp">.Net Core vs .Net Standard vs UWP</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/LearningCollection/C-Sharp/propsVsPublicVars">Properties vs Public variables</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/LearningCollection/C-Sharp/serialization">Serialization</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/LearningCollection/C-Sharp/taskFactoryStartNew">Task.Factory.StartNew()</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/LearningCollection/C-Sharp/threadVsTask">Thread vs Task</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/LearningCollection/C-Sharp/nullCoalescingOperator">Null-coalescing operator</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/LearningCollection/C-Sharp/nullConditionalOperator">Null-conditional operator</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/LearningCollection/C-Sharp/privateProtectedVsProtectedInternal">Private protected vs protected internal access modifier</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/LearningCollection/C-Sharp/unmanagedConstraint">Unmanaged constraint</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/LearningCollection/C-Sharp/unmanagedVsManagedResources">Unmanaged vs managed resources</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/LearningCollection/C-Sharp/volatileKeyword">Volatile Keyword</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Databases</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Tools</a></li><li class="menu__list-item"><a class="menu__link" href="/LearningCollection/">docs-home</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="markdown"><header><h1 class="h1Heading_27L5">Unmanaged constraint</h1></header><p>The unmanaged constraint feature <strong>will give language enforcement to the class of types known as &quot;unmanaged types&quot;</strong> in the C# language spec. This is defined in section 18.2 as a <strong>type which is not a reference type and doesn&#x27;t contain reference type fields at any level of nesting.</strong></p><p>The primary motivation is to make it easier to author low level interop code in C#.</p><p>Interoperability enables you to preserve and take advantage of existing investments in unmanaged code. Code that runs under the control of the common language runtime (CLR) is called managed code, and code that runs outside the CLR is called unmanaged code. COM, COM+, C++ components, ActiveX components, and Microsoft Windows API are examples of unmanaged code.</p><p>Unmanaged types are one of the core building blocks for interop code, yet the lack of support in generics makes it impossible to create re-usable routines across all unmanaged types. Instead developers are forced to author the same boiler plate code for every unmanaged type in their library:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly C#"><pre tabindex="0" class="prism-code language-C# codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">int Hash(Point point) { ... }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">int Hash(TimeSpan timeSpan) { ... }</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>To enable this type of scenario the language will be introducing a new constraint: unmanaged:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly C#"><pre tabindex="0" class="prism-code language-C# codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">void Hash&lt;T&gt;(T value) where T : unmanaged</span></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>This constraint can only be met by types which fit into the unmanaged type definition in the C# language spec. Another way of looking at it is that a type satisfies the unmanaged constraint iff it can also be used as a pointer.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly C#"><pre tabindex="0" class="prism-code language-C# codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Hash(new Point()); // Okay</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Hash(42); // Okay</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Hash(&quot;hello&quot;) // Error: Type string does not satisfy the unmanaged constraint</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Type parameters with the unmanaged constraint can use all the features available to unmanaged types: pointers, fixed, etc ...</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly C#"><pre tabindex="0" class="prism-code language-C# codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">void Hash&lt;T&gt;(T value) where T : unmanaged</span></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Okay</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    fixed (T* p = &amp;value)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        ...</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>This constraint will also make it possible to have efficient conversions between structured data and streams of bytes. This is an operation that is common in networking stacks and serialization layers:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly C#"><pre tabindex="0" class="prism-code language-C# codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Span&lt;byte&gt; Convert&lt;T&gt;(ref T value) where T : unmanaged</span></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Such routines are advantageous because they are provably safe at compile time and allocation free.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="what-is-an-unmanaged-type"></a>What is an unmanaged Type<a class="hash-link" href="#what-is-an-unmanaged-type" title="Direct link to heading">#</a></h2><p>The language will introduce a new constraint named unmanaged. In order to satisfy this constraint a type must be a struct and all the fields of the type must fall into one of the following categories:</p><ul><li>Have the type sbyte, byte, short, ushort, int, uint, long, ulong, char, float, double, decimal, bool, IntPtr or UIntPtr</li><li>Be any enum type</li><li>Be a pointer type</li><li>e a user defined struct that satisfies the unmanaged constraint</li></ul><p>Compiler generated instance fields, such as those backing auto-implemented properties, must also meet these constraints.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly C#"><pre tabindex="0" class="prism-code language-C# codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">// Unmanaged type</span></span><span class="token-line" style="color:#393A34"><span class="token plain">struct Point</span></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    int X;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    int Y {get; set;}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">// Not an unmanaged type</span></span><span class="token-line" style="color:#393A34"><span class="token plain">struct Student</span></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    string FirstName;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    string LastName;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The unmanaged constraint cannot be combined with struct, class or new(). This restriction derives from the fact that unmanaged implies struct hence the other constraints do not make sense.</p><p>The unmanaged constraint is not enforced by CLR, only by the language. To prevent mis-use by other languages, methods which have this constraint will be protected by a mod-req. This will prevent other languages from using type arguments which are not unmanaged types.</p><p>The token unmanaged in the constraint is not a keyword, nor a contextual keyword. Instead it is like var in that it is evaluated at that location and will either:</p><ul><li>Bind to user defined or referenced type named unmanaged: This will be treated just as any other named type constraint is treated</li><li>Bind to no type: This will be interpreted as the unmanaged constraint</li></ul><p>Another Example:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly C#"><pre tabindex="0" class="prism-code language-C# codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">unsafe public static byte[] ToByteArray&lt;T&gt;(this T argument) where T : unmanaged</span></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    var size = sizeof(T);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    var result = new Byte[size];</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    Byte* p = (byte*)&amp;argument;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    for (var i = 0; i &lt; size; i++)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        result[i] = *p++;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    return result;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The preceding method must be compiled in an unsafe context because it uses the sizeof operator on a type not known to be a built-in type. Without the unmanaged constraint, the sizeof operator is unavailable.</p><p><a href="https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/proposals/csharp-7.3/blittable" target="_blank" rel="noopener noreferrer">Reference 1</a>
<a href="https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/generics/constraints-on-type-parameters#unmanaged-constraint" target="_blank" rel="noopener noreferrer">Reference 2</a></p></div><footer class="row docusaurus-mt-lg"><div class="col"><a href="https://github.com/RobinTTY/LearningCollection/tree/master/website/docs/C-Sharp/unmanaged constraint.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_3DPF"></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/LearningCollection/C-Sharp/privateProtectedVsProtectedInternal"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Private protected vs protected internal access modifier</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/LearningCollection/C-Sharp/unmanagedVsManagedResources"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Unmanaged vs managed resources Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#what-is-an-unmanaged-type" class="table-of-contents__link">What is an unmanaged Type</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">My other sites</div><ul class="footer__items"><li class="footer__item"><a href="https://robintty.github.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Website<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Socials</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/RobinTTY" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.linkedin.com/in/robin-m%C3%BCller-574782170/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 Robin MÃ¼ller. Built with Docusaurus.</div></div></div></footer></div>
<script src="/LearningCollection/assets/js/runtime~main.7d13e80f.js"></script>
<script src="/LearningCollection/assets/js/main.f5886633.js"></script>
</body>
</html>