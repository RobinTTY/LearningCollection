<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<title data-react-helmet="true">Closures | Learning Collection Knowledge Base</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://RobinTTY.github.io/LearningCollection/C-Sharp/closures"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Closures | Learning Collection Knowledge Base"><meta data-react-helmet="true" name="description" content="StackOverflow"><meta data-react-helmet="true" property="og:description" content="StackOverflow"><link data-react-helmet="true" rel="icon" href="/LearningCollection/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://RobinTTY.github.io/LearningCollection/C-Sharp/closures"><link data-react-helmet="true" rel="alternate" href="https://RobinTTY.github.io/LearningCollection/C-Sharp/closures" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://RobinTTY.github.io/LearningCollection/C-Sharp/closures" hreflang="x-default"><link rel="stylesheet" href="/LearningCollection/assets/css/styles.dcc5ff64.css">
<link rel="preload" href="/LearningCollection/assets/js/runtime~main.72dfb19e.js" as="script">
<link rel="preload" href="/LearningCollection/assets/js/main.f876d8cb.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/LearningCollection/"><div class="navbar__logo"><img src="/LearningCollection/img/logo.svg" alt="My Site Logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/LearningCollection/img/logo.svg" alt="My Site Logo" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">Learning Collection</b></a><a class="navbar__item navbar__link navbar__link--active" href="/LearningCollection/">Docs</a></div><div class="navbar__items navbar__items--right"><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">ðŸŒœ</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">ðŸŒž</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/LearningCollection/">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/LearningCollection/General Concepts/callStack">General Concepts</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_TwRn" href="/LearningCollection/C-Sharp/DotNet Versions/dotnet6">C-Sharp</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" tabindex="0" href="/LearningCollection/C-Sharp/DotNet Versions/dotnet6">.NET Versions</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/LearningCollection/C-Sharp/aspnet">ASP.NET</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/LearningCollection/C-Sharp/assemblyClass">Assembly Class</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/LearningCollection/C-Sharp/asyncProgramming">Asynchronous Programming</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/LearningCollection/C-Sharp/closures">Closures</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/LearningCollection/C-Sharp/netFramework">.NET Framework</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/LearningCollection/C-Sharp/generics">Generics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/LearningCollection/C-Sharp/ienumerable">IEnumerable</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/LearningCollection/C-Sharp/manResetEvent">ManualResetEvent</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/LearningCollection/C-Sharp/memVsFileStream">Memory Stream vs FileStream</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/LearningCollection/C-Sharp/netstandardVsNetcoreVsUwp">.Net Core vs .Net Standard vs UWP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/LearningCollection/C-Sharp/nullCoalescingOperator">Null-coalescing operator</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/LearningCollection/C-Sharp/nullConditionalOperator">Null-conditional operator</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/LearningCollection/C-Sharp/propsVsPublicVars">Properties vs Public variables</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/LearningCollection/C-Sharp/privateProtectedVsProtectedInternal">Private protected vs protected internal access modifier</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/LearningCollection/C-Sharp/serialization">Serialization</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/LearningCollection/C-Sharp/taskFactoryStartNew">Task.Factory.StartNew()</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/LearningCollection/C-Sharp/threadVsTask">Thread vs Task</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/LearningCollection/C-Sharp/unmanagedConstraint">Unmanaged constraint</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/LearningCollection/C-Sharp/unmanagedVsManagedResources">Unmanaged vs managed resources</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/LearningCollection/C-Sharp/volatileKeyword">Volatile Keyword</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/LearningCollection/Web/JavaScript">Web</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/LearningCollection/Databases/MongoDB/authentication">Databases</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/LearningCollection/Tools/ansible">Tools</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/LearningCollection/Linux/commonlyUsedCommands">Linux</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/LearningCollection/Security/dataObfuscation">Security</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/LearningCollection/Interesting Topics/interestingTopics">Interesting Topics</a></div></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Closures</h1></header><h2 class="anchor anchorWithStickyNavbar_y2LR" id="stackoverflow">StackOverflow<a class="hash-link" href="#stackoverflow" title="Direct link to heading">â€‹</a></h2><p>In essence, a closure is a block of code which can be executed at a later time, but which maintains the environment in which it was first created - i.e. it can still use the local variables etc of the method which created it, even after that method has finished executing.</p><div class="codeBlockContainer_J+bg language-cs theme-code-block"><div class="codeBlockContent_csEI cs"><pre tabindex="0" class="prism-code language-cs codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">using System;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class Test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    static void Main()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Action action = CreateAction();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        action();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        action();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    static Action CreateAction()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        int counter = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return delegate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Yes, it could be done in one statement;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // but it is clearer like this.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            counter++;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Console.WriteLine(&quot;counter={0}&quot;, counter);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Output:</p><div class="codeBlockContainer_J+bg language-cs theme-code-block"><div class="codeBlockContent_csEI cs"><pre tabindex="0" class="prism-code language-cs codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">counter=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">counter=2</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Here we can see that the action returned by CreateAction still has access to the counter variable, and can indeed increment it, even though CreateAction itself has finished.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="c-in-depth">C# in depth<a class="hash-link" href="#c-in-depth" title="Direct link to heading">â€‹</a></h2><p>To put it very simply, closures allow you to encapsulate some behavior, pass it around like any other object, and still have access to the context in which they were first declared.</p><p>This allows you to separate out control structures, logical operators etc from the details of how they&#x27;re going to be used. The ability to access the original context is what separates closures from normal objects, although closure implementations typically achieve this using normal objects and compiler trickery.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="example-situation-filtering-a-list">Example situation: filtering a list<a class="hash-link" href="#example-situation-filtering-a-list" title="Direct link to heading">â€‹</a></h3><p>It&#x27;s reasonably common to want to filter a list by some criterion. This is quite easy to do &quot;inline&quot; by just creating a new list, iterating over the original list and adding the appropriate elements to the new list. It only takes a few lines of code, but it&#x27;s still nice to hide that logic away in one place. The difficult bit is encapsulating which items to include. This is where closures come in.</p><p>Our example will produce a new list containing every element of the original list which matches the given predicate. A predicate is simply something which matches or doesn&#x27;t match a given item.</p><p>In C# the natural way of representing a predicate is as a delegate, and indeed .NET 2.0 contains a <code>Predicate&lt;T&gt;</code> type. (Aside: for some reason LINQ prefers <code>Func&lt;T,bool&gt;</code>; I&#x27;m not sure why, given that it&#x27;s less descriptive. The two are functionally equivalent.)</p><div class="codeBlockContainer_J+bg language-cs theme-code-block"><div class="codeBlockContent_csEI cs"><pre tabindex="0" class="prism-code language-cs codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">// Declaration for System.Predicate&lt;T&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public delegate bool Predicate&lt;T&gt;(T obj)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Code used to filter the list:</p><div class="codeBlockContainer_J+bg language-cs theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_oQzk">ListUtil.cs</div><div class="codeBlockContent_csEI cs"><pre tabindex="0" class="prism-code language-cs codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">static class ListUtil</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static IList&lt;T&gt; Filter&lt;T&gt;(IList&lt;T&gt; source, Predicate&lt;T&gt; predicate)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        List&lt;T&gt; ret = new List&lt;T&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        foreach (T item in source)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (predicate(item))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                ret.Add(item);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return ret;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Now that we&#x27;ve defined our filtering method, we need to call it. In order to demonstrate the importance of closures, we&#x27;ll start with a simple case which can be solved without them, and then move on to something harder.</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="filter-1-matching-short-strings-length-fixed">Filter 1: Matching short strings (length fixed)<a class="hash-link" href="#filter-1-matching-short-strings-length-fixed" title="Direct link to heading">â€‹</a></h4><p>We&#x27;ll take a list of strings, and then produce another list which contains only the &quot;short&quot; strings from the original list. Building a list is clearly simple - it&#x27;s creating the predicate which is the tricky bit. The code looks like this when using a lambda expression:</p><div class="codeBlockContainer_J+bg language-cs theme-code-block"><div class="codeBlockContent_csEI cs"><pre tabindex="0" class="prism-code language-cs codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">static void Main()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Predicate&lt;string&gt; predicate = item =&gt; item.Length &lt; 5;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    IList&lt;string&gt; shortWords = ListUtil.Filter(SampleData.Words, predicate);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ListUtil.Dump(shortWords);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="filter-2-matching-short-strings-variable-length">Filter 2: Matching short strings (variable length)<a class="hash-link" href="#filter-2-matching-short-strings-variable-length" title="Direct link to heading">â€‹</a></h4><p>So far our predicate hasn&#x27;t needed any context - the length is hard-coded, and the string to check is passed to it as a parameter. Let&#x27;s change the situation so that the user can specify the maximum length of strings to allow.</p><div class="codeBlockContainer_J+bg language-cs theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_oQzk">Example2c.cs (C# 3)</div><div class="codeBlockContent_csEI cs"><pre tabindex="0" class="prism-code language-cs codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">static void Main()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Console.Write(&quot;Maximum length of string to include? &quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int maxLength = int.Parse(Console.ReadLine());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Predicate&lt;string&gt; predicate = item =&gt; item.Length &lt;= maxLength;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    IList&lt;string&gt; shortWords = ListUtil.Filter(SampleData.Words, predicate);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ListUtil.Dump(shortWords);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>In C#, the variable itself has been captured by the delegate (delegate = predicate). To prove that C# captures the variable, let&#x27;s change the C# code to change the value of the parameter after the list has been filtered once, and then filter it again:</p><div class="codeBlockContainer_J+bg language-cs theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_oQzk">Example2d.cs</div><div class="codeBlockContent_csEI cs"><pre tabindex="0" class="prism-code language-cs codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">static void Main()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Console.Write(&quot;Maximum length of string to include? &quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int maxLength = int.Parse(Console.ReadLine());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Predicate&lt;string&gt; predicate = item =&gt; item.Length &lt;= maxLength;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    IList&lt;string&gt; shortWords = ListUtil.Filter  (SampleData.Words, predicate);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ListUtil.Dump(shortWords);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Console.WriteLine(&quot;Now for words with &lt;= 5 letters:&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    maxLength = 5;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    shortWords = ListUtil.Filter(SampleData.Words, predicate);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ListUtil.Dump(shortWords);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Note that we&#x27;re only changing the value of the local variable. We&#x27;re not recreating the delegate instance, or anything like that. The delegate instance has access to the local variable, so it can see that it&#x27;s changed. Let&#x27;s go one step further, and make the predicate itself change the value of the variable:</p><div class="codeBlockContainer_J+bg language-cs theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_oQzk">Example2e.cs</div><div class="codeBlockContent_csEI cs"><pre tabindex="0" class="prism-code language-cs codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">static void Main()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int maxLength = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Predicate&lt;string&gt; predicate = item =&gt; { maxLength++; return item.Length &lt;= maxLength; };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    IList&lt;string&gt; shortWords = ListUtil.Filter(SampleData.Words, predicate);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ListUtil.Dump(shortWords);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="comparing-capture-strategies-complexity-vs-power">Comparing capture strategies: complexity vs power<a class="hash-link" href="#comparing-capture-strategies-complexity-vs-power" title="Direct link to heading">â€‹</a></h3><div class="codeBlockContainer_J+bg language-cs theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_oQzk">Example3a.cs</div><div class="codeBlockContent_csEI cs"><pre tabindex="0" class="prism-code language-cs codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">static void Main()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // First build a list of actions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    List&lt;Action&gt; actions = new List&lt;Action&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for (int counter = 0; counter &lt; 10; counter++)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        actions.Add(() =&gt; Console.WriteLine(counter));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Then execute them</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    foreach (Action action in actions)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        action();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>What&#x27;s the output? Well, we&#x27;ve only actually declared a single counter variable - <strong>so that same counter variable is captured by all the Action instances.</strong> The result is the number 10 being printed on every line. To &quot;fix&quot; the code to make it display the output most people would expect (i.e. 0 to 9) we need to introduce an extra variable inside the loop:</p><div class="codeBlockContainer_J+bg language-cs theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_oQzk">Example3b.cs</div><div class="codeBlockContent_csEI cs"><pre tabindex="0" class="prism-code language-cs codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">static void Main()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // First build a list of actions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    List&lt;Action&gt; actions = new List&lt;Action&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for (int counter = 0; counter &lt; 10; counter++)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        int copy = counter;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        actions.Add(() =&gt; Console.WriteLine(copy));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Then execute them</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    foreach (Action action in actions)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        action();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Each time we go through the loop we&#x27;re said to get a different instance of the copy variable - each Action captures a different variable. This makes perfect sense if you look at what the compiler&#x27;s actually doing behind the scenes, but initially it flies in the face of the intuition of most developers (including me).</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="benefits">Benefits<a class="hash-link" href="#benefits" title="Direct link to heading">â€‹</a></h2><p>In the example, we&#x27;ve only seen a little bit of benefit in using a closure. Sure, we&#x27;ve separated out the control structure side from the logic required in the filtering itself, but that&#x27;s not made the code that much simpler on its own.</p><p>This is a familiar situation - a new feature often looks less-than-impressive when used in simplistic examples. <strong>The benefit that closures often bring, however, is composability.</strong> If that sounds like a bit of a stretch, I agree - and that&#x27;s part of the problem. Once you&#x27;re familiar with closures and possibly a little addicted to them, the connection seems very obvious. Until that time, it seems obscure.</p><p>Closures don&#x27;t inherently provide composability. All they do is make it simpler to implement delegates. Without some support for closures, it&#x27;s easier to write a small loop than it is to call another method to do the looping, providing a delegate for some piece of the logic involved.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/RobinTTY/LearningCollection/tree/master/website/docs/C-Sharp/Closures.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/LearningCollection/C-Sharp/asyncProgramming"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Asynchronous Programming</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/LearningCollection/C-Sharp/netFramework"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">.NET Framework</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#stackoverflow" class="table-of-contents__link toc-highlight">StackOverflow</a></li><li><a href="#c-in-depth" class="table-of-contents__link toc-highlight">C# in depth</a><ul><li><a href="#example-situation-filtering-a-list" class="table-of-contents__link toc-highlight">Example situation: filtering a list</a></li><li><a href="#comparing-capture-strategies-complexity-vs-power" class="table-of-contents__link toc-highlight">Comparing capture strategies: complexity vs power</a></li></ul></li><li><a href="#benefits" class="table-of-contents__link toc-highlight">Benefits</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">My other sites</div><ul class="footer__items"><li class="footer__item"><a href="https://robintty.github.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Website<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Socials</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/RobinTTY" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.linkedin.com/in/robin-m%C3%BCller-574782170/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 Robin MÃ¼ller. Built with Docusaurus.</div></div></div></footer></div>
<script src="/LearningCollection/assets/js/runtime~main.72dfb19e.js"></script>
<script src="/LearningCollection/assets/js/main.f876d8cb.js"></script>
</body>
</html>