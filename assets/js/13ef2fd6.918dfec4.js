"use strict";(self.webpackChunklearning_knowledge_base=self.webpackChunklearning_knowledge_base||[]).push([[412],{63913:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>r,contentTitle:()=>a,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"cloud/aws/certified-developer-associate/cognito","title":"Cognito","description":"- Give users an identity to interact with our web or mobile application","source":"@site/docs/cloud/aws/certified-developer-associate/cognito.md","sourceDirName":"cloud/aws/certified-developer-associate","slug":"/cloud/aws/certified-developer-associate/cognito","permalink":"/LearningCollection/cloud/aws/certified-developer-associate/cognito","draft":false,"unlisted":false,"editUrl":"https://github.com/RobinTTY/LearningCollection/tree/master/website/docs/cloud/aws/certified-developer-associate/cognito.md","tags":[],"version":"current","sidebarPosition":23,"frontMatter":{"title":"Cognito","sidebar_position":23},"sidebar":"docs","previous":{"title":"Cloud Development Kit","permalink":"/LearningCollection/cloud/aws/certified-developer-associate/cloud-development-kit"},"next":{"title":"Miscellaneous Serverless","permalink":"/LearningCollection/cloud/aws/certified-developer-associate/misc-serverless"}}');var t=n(74848),o=n(28453);const l={title:"Cognito",sidebar_position:23},a=void 0,r={},d=[{value:"Cognito User Pools (CUP) \u2013 User Features",id:"cognito-user-pools-cup--user-features",level:2},{value:"Integrations",id:"integrations",level:3},{value:"Lambda Triggers",id:"lambda-triggers",level:3},{value:"Hosted Authentication UI",id:"hosted-authentication-ui",level:3},{value:"Hosted UI Custom Domain",id:"hosted-ui-custom-domain",level:3},{value:"Adaptive Authentication",id:"adaptive-authentication",level:3},{value:"Decoding a ID Token; JWT \u2013 JSON Web Token",id:"decoding-a-id-token-jwt--json-web-token",level:3},{value:"Application Load Balancer \u2013 Authenticate Users",id:"application-load-balancer--authenticate-users",level:2},{value:"Auth through Cognito User Pools",id:"auth-through-cognito-user-pools",level:3},{value:"OIDC Authentication",id:"oidc-authentication",level:3},{value:"Auth. Through an Identity Provider (IdP) - OIDC compliant",id:"auth-through-an-identity-provider-idp---oidc-compliant",level:3},{value:"Cognito Identity Pools (Federated Identities)",id:"cognito-identity-pools-federated-identities",level:2},{value:"IAM Roles",id:"iam-roles",level:2},{value:"Guest User example",id:"guest-user-example",level:3},{value:"Policy variable on S3",id:"policy-variable-on-s3",level:3},{value:"DynamoDB",id:"dynamodb",level:3},{value:"Cognito User Pools vs Identity Pools",id:"cognito-user-pools-vs-identity-pools",level:2}];function c(e){const i={a:"a",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"Give users an identity to interact with our web or mobile application"}),"\n",(0,t.jsxs)(i.li,{children:["Cognito User Pools:","\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"Sign in functionality for app users"}),"\n",(0,t.jsx)(i.li,{children:"Integrate with API Gateway & Application Load Balancer"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["Cognito Identity Pools (Federated Identity):","\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"Provide AWS credentials to users so they can access AWS resources directly"}),"\n",(0,t.jsx)(i.li,{children:"Integrate with Cognito User Pools as an identity provider"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(i.li,{children:"Cognito vs IAM: \u201chundreds of users\u201d, \u201dmobile users\u201d, \u201cauthenticate with SAML\u201d"}),"\n"]}),"\n",(0,t.jsx)(i.h2,{id:"cognito-user-pools-cup--user-features",children:"Cognito User Pools (CUP) \u2013 User Features"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"Create a serverless database of user for your web & mobile apps"}),"\n",(0,t.jsx)(i.li,{children:"Simple login: Username (or email) / password combination"}),"\n",(0,t.jsx)(i.li,{children:"Password reset"}),"\n",(0,t.jsx)(i.li,{children:"Email & Phone Number Verification"}),"\n",(0,t.jsx)(i.li,{children:"Multi-factor authentication (MFA)"}),"\n",(0,t.jsx)(i.li,{children:"Federated Identities: users from Facebook, Google, SAML\u2026"}),"\n",(0,t.jsx)(i.li,{children:"Feature: block users if their credentials are compromised elsewhere"}),"\n",(0,t.jsx)(i.li,{children:"Login sends back a JSON Web Token (JWT)"}),"\n"]}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.img,{alt:"cognito-user-pools-diagram",src:n(10456).A+"",width:"1672",height:"727"})}),"\n",(0,t.jsx)(i.h3,{id:"integrations",children:"Integrations"}),"\n",(0,t.jsx)(i.p,{children:"CUP integrates with API Gateway and Application Load Balancer:"}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.img,{alt:"cognito-user-pool-integration",src:n(91454).A+"",width:"1771",height:"652"})}),"\n",(0,t.jsx)(i.h3,{id:"lambda-triggers",children:"Lambda Triggers"}),"\n",(0,t.jsx)(i.p,{children:"CUP can invoke a Lambda function synchronously on these triggers:"}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.img,{alt:"cup-lambda-trigger",src:n(63158).A+"",width:"1563",height:"606"})}),"\n",(0,t.jsx)(i.h3,{id:"hosted-authentication-ui",children:"Hosted Authentication UI"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"Cognito has a hosted authentication UI that you can add to your app to handle sign-up and sign-in workflows"}),"\n",(0,t.jsx)(i.li,{children:"Using the hosted UI, you have a foundation for integration with social logins, OIDC or SAML"}),"\n",(0,t.jsx)(i.li,{children:"Can customize with a custom logo and custom CSS"}),"\n"]}),"\n",(0,t.jsx)(i.h3,{id:"hosted-ui-custom-domain",children:"Hosted UI Custom Domain"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"For custom domains, you must create an ACM certificate in us-east-1"}),"\n",(0,t.jsx)(i.li,{children:"The custom domain must be defined in the \u201cApp Integration\u201d section"}),"\n"]}),"\n",(0,t.jsx)(i.h3,{id:"adaptive-authentication",children:"Adaptive Authentication"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"Block sign-ins or require MFA if the login appears suspicious"}),"\n",(0,t.jsx)(i.li,{children:"Cognito examines each sign-in attempt and generates a risk score (low, medium, high) for how likely the sign-in request is to be from a malicious attacker"}),"\n",(0,t.jsx)(i.li,{children:"Users are prompted for a second MFA only when risk is detected"}),"\n",(0,t.jsx)(i.li,{children:"Risk score is based on different factors such as if the user has used the same device, location, or IP address"}),"\n",(0,t.jsx)(i.li,{children:"Checks for compromised credentials, account takeover protection, and phone and email verification"}),"\n",(0,t.jsx)(i.li,{children:"Integration with CloudWatch Logs (sign-in attempts, risk score, failed challenges\u2026)"}),"\n"]}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.img,{alt:"cup-adaptive-authentication",src:n(46157).A+"",width:"412",height:"813"})}),"\n",(0,t.jsx)(i.h3,{id:"decoding-a-id-token-jwt--json-web-token",children:"Decoding a ID Token; JWT \u2013 JSON Web Token"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["CUP issues JWT tokens (Base64 encoded):","\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"Header"}),"\n",(0,t.jsx)(i.li,{children:"Payload"}),"\n",(0,t.jsx)(i.li,{children:"Signature"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(i.li,{children:"The signature must be verified to ensure the JWT can be trusted"}),"\n",(0,t.jsx)(i.li,{children:"Libraries can help you verify the validity of JWT tokens issued by Cognito User Pools"}),"\n",(0,t.jsx)(i.li,{children:"The Payload will contain the user information (sub UUID, given_name, email, phone_number, attributes\u2026)"}),"\n",(0,t.jsx)(i.li,{children:"From the sub UUID, you can retrieve all users details from Cognito / OIDC"}),"\n"]}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.img,{alt:"cognito-jwt",src:n(244).A+"",width:"736",height:"750"})}),"\n",(0,t.jsx)(i.h2,{id:"application-load-balancer--authenticate-users",children:"Application Load Balancer \u2013 Authenticate Users"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["Your Application Load Balancer can securely authenticate users","\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"Offload the work of authenticating users to your load balancer"}),"\n",(0,t.jsx)(i.li,{children:"Your applications can focus on their business logic"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["Authenticate users through:","\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"Identity Provider (IdP): OpenID Connect (OIDC) compliant"}),"\n",(0,t.jsxs)(i.li,{children:["Cognito User Pools:","\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"Social IdPs, such as Amazon, Facebook, or Google"}),"\n",(0,t.jsx)(i.li,{children:"Corporate identities using SAML, LDAP, or Microsoft AD"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(i.li,{children:(0,t.jsx)(i.strong,{children:"Must use an HTTPS listener to set authenticate-oidc & authenticate-cognito rules"})}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"OnUnauthenticatedRequest"})," \u2013 authenticate (default), deny, allow"]}),"\n"]}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.img,{alt:"cognito-alb-auth",src:n(96329).A+"",width:"1341",height:"697"})}),"\n",(0,t.jsx)(i.h3,{id:"auth-through-cognito-user-pools",children:"Auth through Cognito User Pools"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"Create Cognito User Pool, Client and Domain"}),"\n",(0,t.jsx)(i.li,{children:"Make sure an ID token is returned"}),"\n",(0,t.jsx)(i.li,{children:"Add the social or Corporate IdP if needed"}),"\n",(0,t.jsx)(i.li,{children:"Several URL redirections are necessary"}),"\n",(0,t.jsxs)(i.li,{children:["Allow your Cognito User Pool Domain on your IdP app's callback URL. For example:","\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:(0,t.jsx)(i.a,{href:"https://domain-prefix.auth.region.amazoncognito.com/saml2/idpresponse",children:"https://domain-prefix.auth.region.amazoncognito.com/saml2/idpresponse"})}),"\n",(0,t.jsx)(i.li,{children:(0,t.jsx)(i.a,{href:"https://user-pool-domain/oauth2/idpresponse",children:"https://user-pool-domain/oauth2/idpresponse"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(i.h3,{id:"oidc-authentication",children:"OIDC Authentication"}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.img,{alt:"alb-oidc",src:n(38990).A+"",width:"1417",height:"720"})}),"\n",(0,t.jsx)(i.h3,{id:"auth-through-an-identity-provider-idp---oidc-compliant",children:"Auth. Through an Identity Provider (IdP) - OIDC compliant"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"Configure a Client ID & Client Secret"}),"\n",(0,t.jsxs)(i.li,{children:["Allow redirect from OIDC to your Application Load Balancer DNS name (AWS provided) and CNAME (DNS Alias of your app)","\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:(0,t.jsx)(i.a,{href:"https://DNS/oauth2/idpresponse",children:"https://DNS/oauth2/idpresponse"})}),"\n",(0,t.jsx)(i.li,{children:(0,t.jsx)(i.a,{href:"https://CNAME/oauth2/idpresponse",children:"https://CNAME/oauth2/idpresponse"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(i.h2,{id:"cognito-identity-pools-federated-identities",children:"Cognito Identity Pools (Federated Identities)"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"Get identities for \u201cusers\u201d so they obtain temporary AWS credentials"}),"\n",(0,t.jsxs)(i.li,{children:["Your identity pool (e.g identity source) can include:","\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"Public Providers (Login with Amazon, Facebook, Google, Apple)"}),"\n",(0,t.jsx)(i.li,{children:"Users in an Amazon Cognito user pool"}),"\n",(0,t.jsx)(i.li,{children:"OpenID Connect Providers & SAML Identity Providers"}),"\n",(0,t.jsx)(i.li,{children:"Developer Authenticated Identities (custom login server)"}),"\n",(0,t.jsx)(i.li,{children:"Cognito Identity Pools allow for unauthenticated (guest) access"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["Users can then access AWS services directly or through API Gateway","\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"The IAM policies applied to the credentials are defined in Cognito"}),"\n",(0,t.jsx)(i.li,{children:"They can be customized based on the user_id for fine grained control"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.img,{alt:"cognito-identity-pools",src:n(96579).A+"",width:"1675",height:"757"})}),"\n",(0,t.jsx)(i.p,{children:"With CUP:"}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.img,{alt:"cognito-identity-pools-with-cup",src:n(92357).A+"",width:"1675",height:"757"})}),"\n",(0,t.jsx)(i.h2,{id:"iam-roles",children:"IAM Roles"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"Default IAM roles for authenticated and guest users"}),"\n",(0,t.jsx)(i.li,{children:"Define rules to choose the role for each user based on the user\u2019s ID"}),"\n",(0,t.jsx)(i.li,{children:"You can par tition your users\u2019 access using policy variables"}),"\n",(0,t.jsx)(i.li,{children:"IAM credentials are obtained by Cognito Identity Pools through STS"}),"\n",(0,t.jsx)(i.li,{children:"The roles must have a \u201ctrust\u201d policy of Cognito Identity Pools"}),"\n"]}),"\n",(0,t.jsx)(i.h3,{id:"guest-user-example",children:"Guest User example"}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.img,{alt:"cip-guest-example",src:n(47055).A+"",width:"1078",height:"619"})}),"\n",(0,t.jsx)(i.h3,{id:"policy-variable-on-s3",children:"Policy variable on S3"}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.img,{alt:"cip-policy-variable",src:n(26493).A+"",width:"1363",height:"684"})}),"\n",(0,t.jsx)(i.h3,{id:"dynamodb",children:"DynamoDB"}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.img,{alt:"cip-dynamodb",src:n(20424).A+"",width:"931",height:"661"})}),"\n",(0,t.jsx)(i.h2,{id:"cognito-user-pools-vs-identity-pools",children:"Cognito User Pools vs Identity Pools"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["Cognito User Pools (for authentication = identity verification)","\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"Database of users for your web and mobile application"}),"\n",(0,t.jsx)(i.li,{children:"Allows to federate logins through Public Social, OIDC, SAML\u2026"}),"\n",(0,t.jsx)(i.li,{children:"Can customize the hosted UI for authentication (including the logo)"}),"\n",(0,t.jsx)(i.li,{children:"Has triggers with AWS Lambda during the authentication flow"}),"\n",(0,t.jsx)(i.li,{children:"Adapt the sign-in experience to different risk levels (MFA, adaptive authentication, etc\u2026)"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["Cognito Identity Pools (for authorization = access control)","\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"Obtain AWS credentials for your users"}),"\n",(0,t.jsx)(i.li,{children:"Users can login through Public Social, OIDC, SAML & Cognito User Pools"}),"\n",(0,t.jsx)(i.li,{children:"Users can be unauthenticated (guests)"}),"\n",(0,t.jsx)(i.li,{children:"Users are mapped to IAM roles & policies, can leverage policy variables"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(i.li,{children:"CUP + CIP = authentication + authorization"}),"\n"]})]})}function h(e={}){const{wrapper:i}={...(0,o.R)(),...e.components};return i?(0,t.jsx)(i,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},38990:(e,i,n)=>{n.d(i,{A:()=>s});const s=n.p+"assets/images/alb-oidc-ff650fbc026f7799b35396e7277f112d.png"},20424:(e,i,n)=>{n.d(i,{A:()=>s});const s=n.p+"assets/images/cip-dynamodb-cb35badb786b9540a87e4454107a1d6c.png"},47055:(e,i,n)=>{n.d(i,{A:()=>s});const s=n.p+"assets/images/cip-guest-example-77f0d5003978e70603877d236001cbf5.png"},26493:(e,i,n)=>{n.d(i,{A:()=>s});const s=n.p+"assets/images/cip-policy-variable-cf655be46266473439a73133535b2645.png"},96329:(e,i,n)=>{n.d(i,{A:()=>s});const s=n.p+"assets/images/cognito-alb-auth-04a2eb9b036e64faf51aeaf10fff9e16.png"},92357:(e,i,n)=>{n.d(i,{A:()=>s});const s=n.p+"assets/images/cognito-identity-pools-with-cup-da2a5501965862bb821e26da8c2840c6.png"},96579:(e,i,n)=>{n.d(i,{A:()=>s});const s=n.p+"assets/images/cognito-identity-pools-da2a5501965862bb821e26da8c2840c6.png"},244:(e,i,n)=>{n.d(i,{A:()=>s});const s=n.p+"assets/images/cognito-jwt-05940b17e82358d3918b31290756d320.png"},91454:(e,i,n)=>{n.d(i,{A:()=>s});const s=n.p+"assets/images/cognito-user-pool-integration-756f39c7b62de245fca93037e40df6a0.png"},10456:(e,i,n)=>{n.d(i,{A:()=>s});const s=n.p+"assets/images/cognito-user-pools-diagram-0eb929ed5522517eb9e52b5f2271a8e2.png"},46157:(e,i,n)=>{n.d(i,{A:()=>s});const s=n.p+"assets/images/cup-adaptive-authentication-791245c9efe21991d1d3d656f6cc2499.png"},63158:(e,i,n)=>{n.d(i,{A:()=>s});const s=n.p+"assets/images/cup-lambda-trigger-7bafa4f0ab8440744643e5f84a1a6ecd.png"},28453:(e,i,n)=>{n.d(i,{R:()=>l,x:()=>a});var s=n(96540);const t={},o=s.createContext(t);function l(e){const i=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function a(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),s.createElement(o.Provider,{value:i},e.children)}}}]);