"use strict";(globalThis.webpackChunklearning_knowledge_base=globalThis.webpackChunklearning_knowledge_base||[]).push([[9932],{85329:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>d,default:()=>h,frontMatter:()=>r,metadata:()=>a,toc:()=>c});const a=JSON.parse('{"id":"csharp/entity-framework/data-seeding","title":"Data Seeding","description":"EF 9 introduced UseSeeding and UseAsyncSeeding methods, which provide a convenient way of seeding the database with initial data. They provide one clear location where all the data seeding code can be placed.","source":"@site/docs/csharp/entity-framework/data-seeding.md","sourceDirName":"csharp/entity-framework","slug":"/csharp/entity-framework/data-seeding","permalink":"/LearningCollection/csharp/entity-framework/data-seeding","draft":false,"unlisted":false,"editUrl":"https://github.com/RobinTTY/LearningCollection/tree/master/website/docs/csharp/entity-framework/data-seeding.md","tags":[],"version":"current","frontMatter":{"title":"Data Seeding"},"sidebar":"docs","previous":{"title":"Migrations","permalink":"/LearningCollection/csharp/entity-framework/migrations"},"next":{"title":"Overview","permalink":"/LearningCollection/csharp/entity-framework/creating-a-model/overview"}}');var o=t(74848),i=t(28453);const r={title:"Data Seeding"},d=void 0,s={},c=[{value:"Model managed data",id:"model-managed-data",level:2}];function l(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(n.p,{children:["EF 9 introduced ",(0,o.jsx)(n.code,{children:"UseSeeding"})," and ",(0,o.jsx)(n.code,{children:"UseAsyncSeeding"})," methods, which provide a convenient way of seeding the database with initial data. They provide one clear location where all the data seeding code can be placed."]}),"\n",(0,o.jsxs)(n.p,{children:["The new seeding methods are called as part of ",(0,o.jsx)(n.code,{children:"EnsureCreated"})," operation, ",(0,o.jsx)(n.code,{children:"Migrate"})," and ",(0,o.jsx)(n.code,{children:"dotnet ef database update"})," command, even if there are no model changes and no migrations were applied."]}),"\n",(0,o.jsx)(n.p,{children:"Example:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-csharp",children:'protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)\n    => optionsBuilder\n        .UseSqlServer(@"Server=(localdb)\\mssqllocaldb;Database=EFDataSeeding;Trusted_Connection=True;ConnectRetryCount=0")\n        .UseSeeding((context, _) =>\n        {\n            var testBlog = context.Set<Blog>().FirstOrDefault(b => b.Url == "http://test.com");\n            if (testBlog == null)\n            {\n                context.Set<Blog>().Add(new Blog { Url = "http://test.com" });\n                context.SaveChanges();\n            }\n        })\n        .UseAsyncSeeding(async (context, _, cancellationToken) =>\n        {\n            var testBlog = await context.Set<Blog>().FirstOrDefaultAsync(b => b.Url == "http://test.com", cancellationToken);\n            if (testBlog == null)\n            {\n                context.Set<Blog>().Add(new Blog { Url = "http://test.com" });\n                await context.SaveChangesAsync(cancellationToken);\n            }\n        });\n'})}),"\n",(0,o.jsx)(n.admonition,{type:"tip",children:(0,o.jsxs)(n.p,{children:["Using ",(0,o.jsx)(n.code,{children:"UseSeeding"})," and ",(0,o.jsx)(n.code,{children:"UseAsyncSeeding"})," is the recommended way of seeding the database with initial data when working with EF Core."]})}),"\n",(0,o.jsxs)(n.p,{children:["See: ",(0,o.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/ef/core/modeling/data-seeding",children:"Microsoft Docs"})]}),"\n",(0,o.jsx)(n.h2,{id:"model-managed-data",children:"Model managed data"}),"\n",(0,o.jsx)(n.p,{children:"Data can also be associated with an entity type as part of the model configuration. Then, EF Core migrations can automatically compute what insert, update or delete operations need to be applied when upgrading the database to a new version of the model."}),"\n",(0,o.jsxs)(n.p,{children:["As an example, this will configure managed data for a Country in ",(0,o.jsx)(n.code,{children:"OnModelCreating"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-csharp",children:'modelBuilder.Entity<Country>(b =>\n{\n    b.Property(x => x.Name).IsRequired();\n    b.HasData(\n        new Country { CountryId = 1, Name = "USA" },\n        new Country { CountryId = 2, Name = "Canada" },\n        new Country { CountryId = 3, Name = "Mexico" });\n});\n'})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>d});var a=t(96540);const o={},i=a.createContext(o);function r(e){const n=a.useContext(i);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),a.createElement(i.Provider,{value:n},e.children)}}}]);