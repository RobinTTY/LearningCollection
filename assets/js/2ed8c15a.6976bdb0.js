"use strict";(self.webpackChunklearning_knowledge_base=self.webpackChunklearning_knowledge_base||[]).push([[4002],{6609:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>r,contentTitle:()=>l,default:()=>p,frontMatter:()=>o,metadata:()=>a,toc:()=>c});var i=t(4848),s=t(8453);const o={id:"handling-files",title:"Handling Files"},l=void 0,a={id:"csharp/asp-net/core-concepts/handling-files",title:"Handling Files",description:"ASP.NET Web APIs are able to accept and return files. This page explains how this can be achieved.",source:"@site/docs/csharp/asp-net/core-concepts/handling-files.md",sourceDirName:"csharp/asp-net/core-concepts",slug:"/csharp/asp-net/core-concepts/handling-files",permalink:"/LearningCollection/csharp/asp-net/core-concepts/handling-files",draft:!1,unlisted:!1,editUrl:"https://github.com/RobinTTY/LearningCollection/tree/master/website/docs/csharp/asp-net/core-concepts/handling-files.md",tags:[],version:"current",frontMatter:{id:"handling-files",title:"Handling Files"},sidebar:"docs",previous:{title:"API Errors",permalink:"/LearningCollection/csharp/asp-net/core-concepts/api-errors"},next:{title:"Dependency Injection",permalink:"/LearningCollection/csharp/asp-net/core-concepts/dependency-injection"}},r={},c=[{value:"Handling files in a request",id:"handling-files-in-a-request",level:2},{value:"Handling files as a response",id:"handling-files-as-a-response",level:2}];function d(e){const n={code:"code",h2:"h2",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"ASP.NET Web APIs are able to accept and return files. This page explains how this can be achieved."}),"\n",(0,i.jsx)(n.h2,{id:"handling-files-in-a-request",children:"Handling files in a request"}),"\n",(0,i.jsx)(n.p,{children:"Accepting files via an ASP.NET Web API can be done via a form-data upload. This is the most popular/well-known upload method formatting the data you send as a set of key/value pairs."}),"\n",(0,i.jsxs)(n.p,{children:["You normally need to specify ",(0,i.jsx)(n.code,{children:"Content-Type"})," to ",(0,i.jsx)(n.code,{children:"multipart/form-data"})," in the request, and then use ",(0,i.jsx)(n.code,{children:"[FromForm]"})," attribute in MVC to bind values to variables (not actually explicitly necessary). Also, you can use the built-in ",(0,i.jsx)(n.code,{children:"IFormFile"})," class to access the file uploaded:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:'[HttpPost]\npublic async Task<IActionResult> PostFormData([FromForm] IFormFile file)\n{\n    // Validate the input. Put a limit on filesize to avoid large upload attacks.\n    // Only accept .pdf files (check content type)\n    if(file.Length == 0 ||file.Length > 20_971_520 || file.ContentType != "application/pdf")\n    {\n        return BadRequest("No file or an invalid one has been uploaded.");\n    }\n\n    var pathToFile = Path.Combine(Directory.GetCurrentDirectory(), $"uploaded_file_{Guid.NewGuid()}.pdf");\n\n    using (var fileStream = new FileStream(pathToFile, FileMode.Create))\n    {\n        file.CopyTo(fileStream);\n    }\n\n    // Created can also be returned of course\n    return Ok("Your file has been uploaded successfully.");\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"handling-files-as-a-response",children:"Handling files as a response"}),"\n",(0,i.jsx)(n.p,{children:"Returning files in a response is also possible and can be achieved as follows:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:'[Route("api/files")]\n[ApiController]\npublic class FilesController : ControllerBase\n{\n    private readonly FileExtensionContentTypeProvider _fileExtensionContentTypeProvider;\n\n    public FilesController(FileExtensionContentTypeProvider fileExtensionContentTypeProvider)\n    {\n        _fileExtensionContentTypeProvider = fileExtensionContentTypeProvider\n            ?? throw new System.ArgumentNullException(nameof(fileExtensionContentTypeProvider));\n    }\n\n    [HttpGet("{fileId}")]\n    public ActionResult GetFile(string fileId)\n    {\n        var pathToFile = "someFilePath.pdf";\n\n        // check whether the file exists\n        if (!System.IO.File.Exists(pathToFile)) return NotFound();\n\n        if(!_fileExtensionContentTypeProvider.TryGetContentType(pathToFile, out var contentType))\n        {\n            // fallback/default value\n            contentType = "application/octet-stream";\n        }\n\n        var bytes = System.IO.File.ReadAllBytes(pathToFile);\n        return File(bytes, contentType, Path.GetFileName(pathToFile));\n    }\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["We used the ",(0,i.jsx)(n.code,{children:"FileExtensionContentTypeProvider"})," here which needs to be registered first:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:"builder.Services.AddSingleton<FileExtensionContentTypeProvider>();\n"})})]})}function p(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>l,x:()=>a});var i=t(6540);const s={},o=i.createContext(s);function l(e){const n=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);