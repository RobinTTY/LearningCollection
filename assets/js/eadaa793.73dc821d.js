"use strict";(self.webpackChunklearning_knowledge_base=self.webpackChunklearning_knowledge_base||[]).push([[2200],{7528:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"cloud/aws/certified-developer-associate/cloudformation","title":"CloudFormation","description":"- CloudFormation is a declarative way of outlining your AWS Infrastructure, for any resources (most of them are supported)","source":"@site/docs/cloud/aws/certified-developer-associate/cloudformation.md","sourceDirName":"cloud/aws/certified-developer-associate","slug":"/cloud/aws/certified-developer-associate/cloudformation","permalink":"/LearningCollection/cloud/aws/certified-developer-associate/cloudformation","draft":false,"unlisted":false,"editUrl":"https://github.com/RobinTTY/LearningCollection/tree/master/website/docs/cloud/aws/certified-developer-associate/cloudformation.md","tags":[],"version":"current","sidebarPosition":14,"frontMatter":{"title":"CloudFormation","sidebar_position":14},"sidebar":"docs","previous":{"title":"Elastic Beanstalk","permalink":"/LearningCollection/cloud/aws/certified-developer-associate/elastic-beanstalk"},"next":{"title":"Integration & Messaging","permalink":"/LearningCollection/cloud/aws/certified-developer-associate/integration-messaging"}}');var t=i(74848),l=i(28453);const r={title:"CloudFormation",sidebar_position:14},a=void 0,o={},c=[{value:"Benefits of AWS CloudFormation",id:"benefits-of-aws-cloudformation",level:2},{value:"How CloudFormation Works",id:"how-cloudformation-works",level:2},{value:"Templates",id:"templates",level:3},{value:"Building Blocks",id:"building-blocks",level:3},{value:"Resources",id:"resources",level:3},{value:"Parameters",id:"parameters",level:3},{value:"Parameters Settings",id:"parameters-settings",level:4},{value:"Example",id:"example",level:4},{value:"Referencing parameters",id:"referencing-parameters",level:4},{value:"Pseudo Parameters",id:"pseudo-parameters",level:4},{value:"Mappings",id:"mappings",level:3},{value:"Accessing Mapping Values (Fn::FindInMap)",id:"accessing-mapping-values-fnfindinmap",level:4},{value:"Mappings vs. Parameters",id:"mappings-vs-parameters",level:3},{value:"Outputs",id:"outputs",level:3},{value:"Cross-Stack Reference",id:"cross-stack-reference",level:4},{value:"Conditions",id:"conditions",level:3},{value:"How to define a Condition",id:"how-to-define-a-condition",level:4},{value:"How to use a Condition",id:"how-to-use-a-condition",level:4},{value:"Intrinsic Functions",id:"intrinsic-functions",level:3},{value:"Fn::Ref",id:"fnref",level:4},{value:"Fn::GetAtt",id:"fngetatt",level:4},{value:"Fn::FindInMap",id:"fnfindinmap",level:4},{value:"Fn::ImportValue",id:"fnimportvalue",level:4},{value:"Fn::Base64",id:"fnbase64",level:4},{value:"Condition Functions",id:"condition-functions",level:4},{value:"Rollbacks",id:"rollbacks",level:3},{value:"Service Role",id:"service-role",level:3},{value:"Capabilities",id:"capabilities",level:3},{value:"DeletionPolicy Delete",id:"deletionpolicy-delete",level:4},{value:"DeletionPolicy Retain",id:"deletionpolicy-retain",level:4},{value:"DeletionPolicy Snapshot",id:"deletionpolicy-snapshot",level:4},{value:"Stack Policies",id:"stack-policies",level:4},{value:"Termination Protection",id:"termination-protection",level:4},{value:"Custom Resources",id:"custom-resources",level:3},{value:"Definition",id:"definition",level:4},{value:"Example",id:"example-1",level:4},{value:"StackSets",id:"stacksets",level:3}];function d(e){const n={code:"code",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"CloudFormation is a declarative way of outlining your AWS Infrastructure, for any resources (most of them are supported)"}),"\n",(0,t.jsxs)(n.li,{children:["For example, within a CloudFormation template, you say:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"I want a security group"}),"\n",(0,t.jsx)(n.li,{children:"I want two EC2 instances using this security group"}),"\n",(0,t.jsx)(n.li,{children:"I want two Elastic IPs for these EC2 instances"}),"\n",(0,t.jsx)(n.li,{children:"I want an S3 bucket"}),"\n",(0,t.jsx)(n.li,{children:"I want a load balancer (ELB) in front of these EC2 instances"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:"Then CloudFormation creates those for you, in the right order, with the exact configuration that you specify"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"cf-template",src:i(65491).A+"",width:"1809",height:"727"})}),"\n",(0,t.jsx)(n.h2,{id:"benefits-of-aws-cloudformation",children:"Benefits of AWS CloudFormation"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Infrastructure as code","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"No resources are manually created, which is excellent for control"}),"\n",(0,t.jsx)(n.li,{children:"The code can be version controlled for example using Git"}),"\n",(0,t.jsx)(n.li,{children:"Changes to the infrastructure are reviewed through code"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Cost","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Each resources within the stack is tagged with an identifier so you can easily see how much a stack costs you"}),"\n",(0,t.jsx)(n.li,{children:"You can estimate the costs of your resources using the CloudFormation template"}),"\n",(0,t.jsx)(n.li,{children:"Savings strategy: In Dev, you could automation deletion of templates at 5 PM and recreated at 8 AM, safely"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Productivity","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Ability to destroy and re-create an infrastructure on the cloud on the fly"}),"\n",(0,t.jsx)(n.li,{children:"Automated generation of Diagram for your templates!"}),"\n",(0,t.jsx)(n.li,{children:"Declarative programming (no need to figure out ordering and orchestration)"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Separation of concern: create many stacks for many apps, and many layers. Ex:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"VPC stacks"}),"\n",(0,t.jsx)(n.li,{children:"Network stacks"}),"\n",(0,t.jsx)(n.li,{children:"App stacks"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Don\u2019t re-invent the wheel","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Leverage existing templates on the web!"}),"\n",(0,t.jsx)(n.li,{children:"Leverage the documentation"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"how-cloudformation-works",children:"How CloudFormation Works"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Templates must be uploaded in S3 and then referenced in CloudFormation"}),"\n",(0,t.jsx)(n.li,{children:"To update a template, we can\u2019t edit previous ones. We have to reupload a new version of the template to AWS"}),"\n",(0,t.jsx)(n.li,{children:"Stacks are identified by a name"}),"\n",(0,t.jsx)(n.li,{children:"Deleting a stack deletes every single artifact that was created by CloudFormation"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"cloud-formation-work",src:i(78084).A+"",width:"1674",height:"192"})}),"\n",(0,t.jsx)(n.h3,{id:"templates",children:"Templates"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Manual way","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Editing templates in Application Composer or code editor"}),"\n",(0,t.jsx)(n.li,{children:"Using the console to input parameters, etc\u2026"}),"\n",(0,t.jsx)(n.li,{children:"We\u2019ll mostly do this way in the course for learning purposes"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Automated way","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Editing templates in a YAML file"}),"\n",(0,t.jsx)(n.li,{children:"Using the AWS CLI (Command Line Interface) to deploy the templates, or using a Continuous Delivery (CD) tool"}),"\n",(0,t.jsx)(n.li,{children:"Recommended way when you fully want to automate your flow"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"building-blocks",children:"Building Blocks"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Template\u2019s Components","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"AWSTemplateFormatVersion \u2013 identifies the capabilities of the template \u201c2010-09-09\u201d"}),"\n",(0,t.jsx)(n.li,{children:"Description \u2013 comments about the template"}),"\n",(0,t.jsx)(n.li,{children:"Resources (MANDATORY) \u2013 your AWS resources declared in the template"}),"\n",(0,t.jsx)(n.li,{children:"Parameters \u2013 the dynamic inputs for your template"}),"\n",(0,t.jsx)(n.li,{children:"Mappings \u2013 the static variables for your template"}),"\n",(0,t.jsx)(n.li,{children:"Outputs \u2013 references to what has been created"}),"\n",(0,t.jsx)(n.li,{children:"Conditionals \u2013 list of conditions to perform resource creation"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Template\u2019s Helpers","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"References"}),"\n",(0,t.jsx)(n.li,{children:"Functions"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"resources",children:"Resources"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Resources are the core of your CloudFormation template (MANDATORY)"}),"\n",(0,t.jsx)(n.li,{children:"They represent the different AWS Components that will be created and configured"}),"\n",(0,t.jsx)(n.li,{children:"Resources are declared and can reference each other"}),"\n",(0,t.jsx)(n.li,{children:"AWS figures out creation, updates and deletes of resources for us"}),"\n",(0,t.jsx)(n.li,{children:"There are over 700 types of resources (!)"}),"\n",(0,t.jsxs)(n.li,{children:["Resource types identifiers are of the form:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"service-provider::service-name::data-type-name"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"parameters",children:"Parameters"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Parameters are a way to provide inputs to your AWS CloudFormation template"}),"\n",(0,t.jsxs)(n.li,{children:["They\u2019re important to know about if:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"You want to reuse your templates across the company"}),"\n",(0,t.jsx)(n.li,{children:"Some inputs can not be determined ahead of time"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:"Parameters are extremely powerful, controlled, and can prevent errors from happening in your templates, thanks to types"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"cf-parameters",src:i(59193).A+"",width:"535",height:"841"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Ask yourself this:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Is this CloudFormation resource configuration likely to change in the future?"}),"\n",(0,t.jsx)(n.li,{children:"If so, make it a parameter"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:"You won\u2019t have to re-upload a template to change its content"}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"parameters-settings",children:"Parameters Settings"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"cf-parameter-settings",src:i(42112).A+"",width:"1557",height:"664"})}),"\n",(0,t.jsx)(n.h4,{id:"example",children:"Example"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"cf-parameter-example",src:i(64669).A+"",width:"1437",height:"712"})}),"\n",(0,t.jsx)(n.h4,{id:"referencing-parameters",children:"Referencing parameters"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"The Fn::Ref function can be leveraged to reference parameters"}),"\n",(0,t.jsx)(n.li,{children:"Parameters can be used anywhere in a template"}),"\n",(0,t.jsx)(n.li,{children:"The shorthand for this in YAML is !Ref"}),"\n",(0,t.jsx)(n.li,{children:"The function can also reference other elements within the template"}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"pseudo-parameters",children:"Pseudo Parameters"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"AWS offers us Pseudo Parameters in any CloudFormation template"}),"\n",(0,t.jsx)(n.li,{children:"These can be used at any time and are enabled by default"}),"\n",(0,t.jsx)(n.li,{children:"Important pseudo parameters:"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"cf-pseudo-params",src:i(60048).A+"",width:"1540",height:"457"})}),"\n",(0,t.jsx)(n.h3,{id:"mappings",children:"Mappings"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Mappings are fixed variables within your CloudFormation template"}),"\n",(0,t.jsx)(n.li,{children:"They\u2019re very handy to differentiate between different environments (dev vs prod), regions (AWS regions), AMI types\u2026"}),"\n",(0,t.jsx)(n.li,{children:"All the values are hardcoded within the template"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"cf-mappings",src:i(65600).A+"",width:"1090",height:"406"})}),"\n",(0,t.jsx)(n.h4,{id:"accessing-mapping-values-fnfindinmap",children:"Accessing Mapping Values (Fn::FindInMap)"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"We use Fn::FindInMap to return a named value from a specific key"}),"\n",(0,t.jsx)(n.li,{children:"!FindInMap [ MapName, TopLevelKey, SecondLevelKey ]"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"cf-mapping-values",src:i(14540).A+"",width:"1582",height:"508"})}),"\n",(0,t.jsx)(n.h3,{id:"mappings-vs-parameters",children:"Mappings vs. Parameters"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Mappings are great when you know in advance all the values that can be taken and that they can be deduced from variables such as","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Region"}),"\n",(0,t.jsx)(n.li,{children:"Availability Zone"}),"\n",(0,t.jsx)(n.li,{children:"AWS Account"}),"\n",(0,t.jsx)(n.li,{children:"Environment (dev vs prod)"}),"\n",(0,t.jsx)(n.li,{children:"etc\u2026"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:"They allow safer control over the template"}),"\n",(0,t.jsx)(n.li,{children:"Use parameters when the values are really user specific"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"outputs",children:"Outputs"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"The Outputs section declares optional outputs values that we can import into other stacks (if you export them first)!"}),"\n",(0,t.jsx)(n.li,{children:"You can also view the outputs in the AWS Console or in using the AWS CLI"}),"\n",(0,t.jsx)(n.li,{children:"They\u2019re very useful for example if you define a network CloudFormation, and output the variables such as VPC ID and your Subnet IDs"}),"\n",(0,t.jsx)(n.li,{children:"It\u2019s the best way to perform some collaboration cross stack, as you let expert handle their own part of the stack"}),"\n",(0,t.jsx)(n.li,{children:"Creating a SSH Security Group as part of one template"}),"\n",(0,t.jsx)(n.li,{children:"We create an output that references that security group"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"cf-outputs",src:i(26271).A+"",width:"1342",height:"403"})}),"\n",(0,t.jsx)(n.h4,{id:"cross-stack-reference",children:"Cross-Stack Reference"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"We then create a second template that leverages that security group"}),"\n",(0,t.jsx)(n.li,{children:"For this, we use the Fn::ImportValue function"}),"\n",(0,t.jsx)(n.li,{children:"You can\u2019t delete the underlying stack until all the references are deleted"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"cf-cross-stack-reference",src:i(84222).A+"",width:"793",height:"442"})}),"\n",(0,t.jsx)(n.h3,{id:"conditions",children:"Conditions"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Conditions are used to control the creation of resources or outputs based on a condition"}),"\n",(0,t.jsxs)(n.li,{children:["Conditions can be whatever you want them to be, but common ones are:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Environment (dev / test / prod)"}),"\n",(0,t.jsx)(n.li,{children:"AWS Region"}),"\n",(0,t.jsx)(n.li,{children:"Any parameter value"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:"Each condition can reference another condition, parameter value or mapping"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"cf-conditions",src:i(47675).A+"",width:"607",height:"903"})}),"\n",(0,t.jsx)(n.h4,{id:"how-to-define-a-condition",children:"How to define a Condition"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"Conditions:\n  CreateProdResources: !Equals [!Ref EnvType, prod]\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"The logical ID is for you to choose. It\u2019s how you name condition"}),"\n",(0,t.jsxs)(n.li,{children:["The intrinsic function (logical) can be any of the following:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Fn::And"}),"\n",(0,t.jsx)(n.li,{children:"Fn::Equals"}),"\n",(0,t.jsx)(n.li,{children:"Fn::If"}),"\n",(0,t.jsx)(n.li,{children:"Fn::Not"}),"\n",(0,t.jsx)(n.li,{children:"Fn::Or"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"how-to-use-a-condition",children:"How to use a Condition"}),"\n",(0,t.jsx)(n.p,{children:"Conditions can be applied to resources / outputs / etc\u2026"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"Resources:\n  MountPoint:\n    Type: AWS::EC2::VolumeAttachment\n    Condition: CreateProdResources\n"})}),"\n",(0,t.jsx)(n.h3,{id:"intrinsic-functions",children:"Intrinsic Functions"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Ref"}),"\n",(0,t.jsx)(n.li,{children:"Fn::GetAtt"}),"\n",(0,t.jsx)(n.li,{children:"Fn::FindInMap"}),"\n",(0,t.jsx)(n.li,{children:"Fn::ImportValue"}),"\n",(0,t.jsx)(n.li,{children:"Fn::Base64"}),"\n",(0,t.jsx)(n.li,{children:"Condition Functions (Fn::If, Fn::Not, Fn::Equals, etc\u2026)"}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"fnref",children:"Fn::Ref"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["The Fn::Ref function can be leveraged to reference","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Parameters \u2013 returns the value of the parameter"}),"\n",(0,t.jsx)(n.li,{children:"Resources \u2013 returns the physical ID of the underlying resource (e.g., EC2 ID)"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:"The shorthand for this in YAML is !Ref"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"Resources:\n  DBSubnet1:\n    Type: AWS::EC2::Subnet\n    Properties:\n      VpcId: !Ref MyVPC\n"})}),"\n",(0,t.jsx)(n.h4,{id:"fngetatt",children:"Fn::GetAtt"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Attributes are attached to any resources you create"}),"\n",(0,t.jsx)(n.li,{children:"To know the attributes of your resources, the best place to look at is the documentation"}),"\n",(0,t.jsx)(n.li,{children:"Example: the AZ of an EC2 instance!"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"getatt",src:i(98772).A+"",width:"1765",height:"303"})}),"\n",(0,t.jsx)(n.h4,{id:"fnfindinmap",children:"Fn::FindInMap"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"We use Fn::FindInMap to return a named value from a specific key"}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"!FindInMap [ MapName, TopLevelKey, SecondLevelKey ]"})}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"findinmap",src:i(49259).A+"",width:"955",height:"517"})}),"\n",(0,t.jsx)(n.h4,{id:"fnimportvalue",children:"Fn::ImportValue"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Import values that are exported in other stacks"}),"\n",(0,t.jsx)(n.li,{children:"For this, we use the Fn::ImportValue function"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"importValue",src:i(67175).A+"",width:"790",height:"448"})}),"\n",(0,t.jsx)(n.h4,{id:"fnbase64",children:"Fn::Base64"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Convert String to it\u2019s Base64 representation","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:'!Base64 "ValueToEncode"'})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:"Example: pass encoded data to EC2 Instance\u2019s UserData property"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"base64",src:i(84228).A+"",width:"526",height:"408"})}),"\n",(0,t.jsx)(n.h4,{id:"condition-functions",children:"Condition Functions"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"Conditions:\n  CreateProdResources: !Equals [!Ref EnvType, prod]\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"The logical ID is for you to choose. It\u2019s how you name condition"}),"\n",(0,t.jsxs)(n.li,{children:["The intrinsic function (logical) can be any of the following:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Fn::And"}),"\n",(0,t.jsx)(n.li,{children:"Fn::Equals"}),"\n",(0,t.jsx)(n.li,{children:"Fn::If"}),"\n",(0,t.jsx)(n.li,{children:"Fn::Not"}),"\n",(0,t.jsx)(n.li,{children:"Fn::Or"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"rollbacks",children:"Rollbacks"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Stack Creation Fails:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Default: everything rolls back (gets deleted). We can look at the log"}),"\n",(0,t.jsx)(n.li,{children:"Option to disable rollback and troubleshoot what happened"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Stack Update Fails:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"The stack automatically rolls back to the previous known working state"}),"\n",(0,t.jsx)(n.li,{children:"Ability to see in the log what happened and error messages"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Rollback Failure? Fix resources manually then issue ContinueUpdateRollback API from Console","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Or from the CLI using continue-update-rollback API call"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"service-role",children:"Service Role"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"IAM role that allows CloudFormation to create/update/delete stack resources on your behalf"}),"\n",(0,t.jsx)(n.li,{children:"Give ability to users to create/update/delete the stack resources even if they don\u2019t have permissions to work with the resources in the stack"}),"\n",(0,t.jsxs)(n.li,{children:["Use cases:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"You want to achieve the least privilege principle"}),"\n",(0,t.jsx)(n.li,{children:"But you don\u2019t want to give the user all the required permissions to create the stack resources"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["User must have iam",":PassRole"," permissions"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"cf-service-role",src:i(3491).A+"",width:"567",height:"967"})}),"\n",(0,t.jsx)(n.h3,{id:"capabilities",children:"Capabilities"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["CAPABILITY_NAMED_IAM and CAPABILITY_IAM","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Necessary to enable when you CloudFormation template is creating or updating IAM resources (IAM User, Role, Group, Policy, Access Keys, Instance Profile\u2026)"}),"\n",(0,t.jsx)(n.li,{children:"Specify CAPABILITY_NAMED_IAM if the resources are named"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["CAPABILITY_AUTO_EXPAND","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Necessary when your CloudFormation template includes Macros or Nested Stacks (stacks within stacks) to perform dynamic transformations"}),"\n",(0,t.jsx)(n.li,{children:"You\u2019re acknowledging that your template may change before deploying"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["InsufficientCapabilitiesException","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Exception that will be thrown by CloudFormation if the capabilities haven\u2019t been acknowledged when deploying a template (security measure)"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"deletionpolicy-delete",children:"DeletionPolicy Delete"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"cf-deletion",src:i(27763).A+"",width:"1581",height:"669"})}),"\n",(0,t.jsx)(n.h4,{id:"deletionpolicy-retain",children:"DeletionPolicy Retain"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Specify on resources to preserve in case of CloudFormation deletes"}),"\n",(0,t.jsx)(n.li,{children:"Works with any resource"}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"deletionpolicy-snapshot",children:"DeletionPolicy Snapshot"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Create one final snapshot before deleting the resource"}),"\n",(0,t.jsxs)(n.li,{children:["Examples of supported resources:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"EBS Volume, ElastiCache Cluster, ElastiCache ReplicationGroup"}),"\n",(0,t.jsx)(n.li,{children:"RDS DBInstance, RDS DBCluster, Redshift Cluster, Neptune DBCluster, DocumentDB DBCluster"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"stack-policies",children:"Stack Policies"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"During a CloudFormation Stack update, all update actions are allowed on all resources (default)"}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.strong,{children:"A Stack Policy is a JSON document that defines the update actions that are allowed on specific resources during Stack updates"})}),"\n",(0,t.jsx)(n.li,{children:"Protect resources from unintentional updates"}),"\n",(0,t.jsxs)(n.li,{children:["When you set a Stack Policy, all resources in the Stack are protected by default","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Specify an explicit ALLOW for the resources you want to be allowed to be updated"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"stackpolicy-example",src:i(28010).A+"",width:"723",height:"592"})}),"\n",(0,t.jsx)(n.h4,{id:"termination-protection",children:"Termination Protection"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"To prevent accidental deletes of CloudFormation Stacks, use TerminationProtection"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"custom-resources",children:"Custom Resources"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Used to","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"define resources not yet supported by CloudFormation"}),"\n",(0,t.jsx)(n.li,{children:"define custom provisioning logic for resources can that be outside of CloudFormation (on-premises resources, 3rd party resources\u2026)"}),"\n",(0,t.jsx)(n.li,{children:"have custom scripts run during create / update / delete through Lambda functions (running a Lambda function to empty an S3 bucket before being deleted)"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:"Defined in the template using AWS::CloudFormation::CustomResource or Custom::MyCustomResourceTypeName (recommended)"}),"\n",(0,t.jsx)(n.li,{children:"Backed by a Lambda function (most common) or an SNS topic"}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"definition",children:"Definition"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"ServiceToken specifies where CloudFormation sends requests to, such as Lambda ARN or SNS ARN (required & must be in the same region)"}),"\n",(0,t.jsx)(n.li,{children:"Input data parameters (optional)"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"custom-resource",src:i(88595).A+"",width:"1459",height:"318"})}),"\n",(0,t.jsx)(n.h4,{id:"example-1",children:"Example"}),"\n",(0,t.jsx)(n.p,{children:"Use Case: Delete content from an S3 bucket"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"cf-custom-example",src:i(51945).A+"",width:"1555",height:"808"})}),"\n",(0,t.jsx)(n.h3,{id:"stacksets",children:"StackSets"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Create, update, or delete stacks across multiple accounts and regions with a single operation/template"}),"\n",(0,t.jsx)(n.li,{children:"Target accounts to create, update, delete stack instances from StackSets"}),"\n",(0,t.jsx)(n.li,{children:"When you update a stack set, all associated stack instances are updated throughout all accounts and regions"}),"\n",(0,t.jsx)(n.li,{children:"Can be applied into all accounts of an AWS Organization"}),"\n",(0,t.jsx)(n.li,{children:"Only Administrator account (or Delegated Administrator) can create StackSets"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},84228:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/base64-190cb6bc0cafc62ee140639d5e2c8699.png"},47675:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/cf-conditions-08f8d02f2fbcb9158158977b04bb6305.png"},84222:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/cf-cross-stack-reference-d5930f3ddae74496a3f6edda2ba1adf9.png"},51945:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/cf-custom-example-0782f9076011105dc18649d90b744b16.png"},27763:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/cf-deletion-20d927eec16967d33a3a79e23c4c52cf.png"},14540:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/cf-mapping-values-1b32c17ac8569fea7fb3ab1bc175aeef.png"},65600:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/cf-mappings-38c3bb0af548ded2e6ad24ad04a3881a.png"},26271:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/cf-outputs-2afed6459a3e12361ae7970c59928fce.png"},64669:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/cf-parameter-example-9de74faadce3686b85dea8f8c3a5e755.png"},42112:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/cf-parameter-settings-c85bcda155050df2ebfa79b121437b2e.png"},59193:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/cf-parameters-d5a2cd1feb587a880dc7d441db211d03.png"},60048:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/cf-pseudo-params-c32bcbdc6a281f180426cf0174ddda35.png"},3491:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/cf-service-role-0131b28de87f0b57bf8a98f4d435a5f9.png"},65491:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/cf-template-ae942211468d48a11a459fa786a25a5a.png"},78084:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/cloud-formation-work-c0890065b4216c5edd93f077eee1aa31.png"},88595:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/custom-resource-7923b203ef63ae98aff58cad064342bb.png"},49259:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/findinmap-a2eb8189f3e918418b675579ec844928.png"},98772:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/getatt-e79482f2699d2927944eed48282c9498.png"},67175:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/importValue-3d7c585b1f0fa036c7ad233087eaa6e8.png"},28010:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/stackpolicy-example-365c5a97a375e911c1ab1985b15571f6.png"},28453:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>a});var s=i(96540);const t={},l=s.createContext(t);function r(e){const n=s.useContext(l);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),s.createElement(l.Provider,{value:n},e.children)}}}]);