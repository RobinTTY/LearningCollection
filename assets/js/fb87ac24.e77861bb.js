"use strict";(self.webpackChunklearning_knowledge_base=self.webpackChunklearning_knowledge_base||[]).push([[8263],{8471:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>r,default:()=>h,frontMatter:()=>s,metadata:()=>l,toc:()=>c});var o=i(5893),t=i(1151);const s={id:"resiliency",title:"Resiliency",sidebar_position:6},r=void 0,l={id:"databases/mongodb/m220n-mongodb-for-dotnet-developers/resiliency",title:"Resiliency",description:"Connection pooling",source:"@site/docs/databases/mongodb/m220n-mongodb-for-dotnet-developers/Resiliency.md",sourceDirName:"databases/mongodb/m220n-mongodb-for-dotnet-developers",slug:"/databases/mongodb/m220n-mongodb-for-dotnet-developers/resiliency",permalink:"/LearningCollection/databases/mongodb/m220n-mongodb-for-dotnet-developers/resiliency",draft:!1,unlisted:!1,editUrl:"https://github.com/RobinTTY/LearningCollection/tree/master/website/docs/databases/mongodb/m220n-mongodb-for-dotnet-developers/Resiliency.md",tags:[],version:"current",sidebarPosition:6,frontMatter:{id:"resiliency",title:"Resiliency",sidebar_position:6},sidebar:"docs",previous:{title:"Admin Backend",permalink:"/LearningCollection/databases/mongodb/m220n-mongodb-for-dotnet-developers/adminBackend"},next:{title:"Notes on MongoDB",permalink:"/LearningCollection/databases/mongodb/m220n-mongodb-for-dotnet-developers/notesOnMongoDB"}},a={},c=[{value:"Connection pooling",id:"connection-pooling",level:2},{value:"Example",id:"example",level:3},{value:"Write timeouts",id:"write-timeouts",level:2},{value:"Example",id:"example-1",level:3},{value:"ServerSelectionTimeout",id:"serverselectiontimeout",level:2},{value:"Example",id:"example-2",level:3},{value:"Principle of Least Privilege",id:"principle-of-least-privilege",level:2},{value:"User management at the database level",id:"user-management-at-the-database-level",level:3},{value:"Summary",id:"summary",level:2}];function d(e){const n={a:"a",blockquote:"blockquote",br:"br",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.a)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h2,{id:"connection-pooling",children:"Connection pooling"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"A way of reusing database connections"}),"\n",(0,o.jsx)(n.li,{children:"Creating a connection to the database requires time and computing resources"}),"\n",(0,o.jsx)(n.li,{children:"Connection Pooling helps reduce the overhead of creating database connections"}),"\n",(0,o.jsx)(n.li,{children:"By default the driver will create a pool of 100 connections to share"}),"\n",(0,o.jsx)(n.li,{children:"Subsequent requests appear faster to the client"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"connection pool",src:i(3640).Z+"",width:"821",height:"476"})}),"\n",(0,o.jsx)(n.h3,{id:"example",children:"Example"}),"\n",(0,o.jsx)(n.p,{children:"Defined in the connection string:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-txt",children:"mongodb+srv://user:password@server.net?maxPoolSize=50\n"})}),"\n",(0,o.jsxs)(n.p,{children:["For more options see: ",(0,o.jsx)(n.a,{href:"https://docs.mongodb.com/manual/reference/connection-string/",children:"MongoDB Docs"})]}),"\n",(0,o.jsx)(n.p,{children:"Defined in code:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-cs",children:"_client = new MongoClient(new MongoClientSettings(){ MaxConnectionPoolSize = 50});\n"})}),"\n",(0,o.jsx)(n.h2,{id:"write-timeouts",children:"Write timeouts"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"We should always expect application external resources like queues, networks and databases to take more time than expected"}),"\n",(0,o.jsx)(n.li,{children:"We can configure a write timeout to handle theses instances appropriately"}),"\n",(0,o.jsx)(n.li,{children:'Especially when we use the WriteConcern "majority" we should always configure an appropriate timeout'}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"By default"}),", when using Write Concern more durable than w: 1, ",(0,o.jsx)(n.strong,{children:"there is no wtimeout"}),", so ",(0,o.jsx)(n.strong,{children:"the server will wait indefinitely"})," for operations to complete"]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"example-1",children:"Example"}),"\n",(0,o.jsx)(n.p,{children:"Defined in the connection string:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-txt",children:"mongodb+srv://user:password@server.net?wtimeoutMS=2500\n"})}),"\n",(0,o.jsx)(n.p,{children:"Defined in code:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-cs",children:"_client = new MongoClient(Constants.MongoDbConnectionUriWithMaxPoolSize).WithWriteConcern(\n                new WriteConcern(wTimeout: TimeSpan.FromMilliseconds(2500))) as MongoClient;\n"})}),"\n",(0,o.jsx)(n.h2,{id:"serverselectiontimeout",children:"ServerSelectionTimeout"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"It is important to always handle the ServerSelectionTimeout"}),"\n",(0,o.jsx)(n.li,{children:"By handling the error we can also passively monitor the health of our application stack"}),"\n",(0,o.jsx)(n.li,{children:"E.g. if a database server goes down we can identify what happened through handling the error"}),"\n",(0,o.jsx)(n.li,{children:"By default the driver waits 30 seconds before raising a ServerSelectionTimeout exception but this time can be changed"}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"example-2",children:"Example"}),"\n",(0,o.jsx)(n.p,{children:"Defined in the connection string:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-txt",children:"mongodb+srv://user:password@server.net?serverSelectionTimeoutMS=5000\n"})}),"\n",(0,o.jsx)(n.p,{children:"Defined in code:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-cs",children:"_client = new MongoClient(new MongoClientSettings(){ ServerSelectionTimeout = TimeSpan.FromMilliseconds(5000)});\n"})}),"\n",(0,o.jsx)(n.h2,{id:"principle-of-least-privilege",children:"Principle of Least Privilege"}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"Every program and every privileged user of the system should operate using the least amount of privilege necessary to complete the job."}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"Jerome Saltzer, Communications of the ACM"}),"\n",(0,o.jsx)(n.h3,{id:"user-management-at-the-database-level",children:"User management at the database level"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"MongoDB offers user management at the database level"}),"\n",(0,o.jsx)(n.li,{children:"by creating a database user specifically for the application, we can in a more granular way select the privileges and resources that mFlix should have access to"}),"\n",(0,o.jsx)(n.li,{children:"this kind of forces us to ask the question, should the application be able to create indexes or create new collections, or should the application be able to drop an entire database?"}),"\n",(0,o.jsx)(n.li,{children:"very important in order to prevent the application from accessing a resource that it should never need"}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.strong,{children:"If the application has permission to use an important collection that it's not programmed to ever use, than that permission exists only as a vulnerability in our application, and we should remove it"})}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["More resources on security within MongoDB see: ",(0,o.jsx)(n.a,{href:"https://university.mongodb.com/courses/M310/about",children:"MongoDB University"}),"."]}),"\n",(0,o.jsxs)(n.p,{children:["Course was retired to push Atlas... \ud83d\ude44",(0,o.jsx)(n.br,{}),"\n","See ",(0,o.jsx)(n.a,{href:"https://docs.mongodb.com/manual/security/",children:"Documentation"})," instead."]}),"\n",(0,o.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Always use connection pooling"}),"\n",(0,o.jsx)(n.li,{children:'Always specify a wtimeout with majority writes (or even a write concern more durable than "1")'}),"\n",(0,o.jsx)(n.li,{children:"Always handle serverSelectionTimeout errors"}),"\n",(0,o.jsx)(n.li,{children:"Always handle errors like with any C# application"}),"\n",(0,o.jsx)(n.li,{children:"Engineer systems with the principle of least privilege in mind"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},3640:(e,n,i)=>{i.d(n,{Z:()=>o});const o=i.p+"assets/images/connectionPool-8caa20728134a848beb11974938109a2.PNG"},1151:(e,n,i)=>{i.d(n,{Z:()=>l,a:()=>r});var o=i(7294);const t={},s=o.createContext(t);function r(e){const n=o.useContext(s);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),o.createElement(s.Provider,{value:n},e.children)}}}]);