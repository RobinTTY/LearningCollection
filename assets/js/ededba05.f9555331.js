"use strict";(globalThis.webpackChunklearning_knowledge_base=globalThis.webpackChunklearning_knowledge_base||[]).push([[3681],{87120:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>r,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"cloud/aws/certified-developer-associate/api-gateway","title":"API Gateway","description":"- AWS Lambda + API Gateway: No infrastructure to manage","source":"@site/docs/cloud/aws/certified-developer-associate/api-gateway.md","sourceDirName":"cloud/aws/certified-developer-associate","slug":"/cloud/aws/certified-developer-associate/api-gateway","permalink":"/LearningCollection/cloud/aws/certified-developer-associate/api-gateway","draft":false,"unlisted":false,"editUrl":"https://github.com/RobinTTY/LearningCollection/tree/master/website/docs/cloud/aws/certified-developer-associate/api-gateway.md","tags":[],"version":"current","sidebarPosition":19,"frontMatter":{"title":"API Gateway","sidebar_position":19},"sidebar":"docs","previous":{"title":"DynamoDB","permalink":"/LearningCollection/cloud/aws/certified-developer-associate/dynamodb"},"next":{"title":"CI/CD","permalink":"/LearningCollection/cloud/aws/certified-developer-associate/ci-cd"}}');var a=i(74848),t=i(28453);const l={title:"API Gateway",sidebar_position:19},r=void 0,o={},c=[{value:"Architecture",id:"architecture",level:2},{value:"Integrations High Level",id:"integrations-high-level",level:2},{value:"Example: Serverless API",id:"example-serverless-api",level:3},{value:"Example: Kinesis Data Streams",id:"example-kinesis-data-streams",level:3},{value:"Endpoint Types",id:"endpoint-types",level:2},{value:"Security",id:"security",level:2},{value:"IAM Permissions",id:"iam-permissions",level:3},{value:"Resource Policies",id:"resource-policies",level:3},{value:"Cognito User Pools",id:"cognito-user-pools",level:3},{value:"Lambda Authorizer (formerly Custom Authorizers)",id:"lambda-authorizer-formerly-custom-authorizers",level:3},{value:"Summary",id:"summary",level:3},{value:"Deployment Stages",id:"deployment-stages",level:2},{value:"Stages v1 and v2 API breaking change",id:"stages-v1-and-v2-api-breaking-change",level:3},{value:"Stage Variables",id:"stage-variables",level:3},{value:"Stage Variables &amp; Lambda Aliases",id:"stage-variables--lambda-aliases",level:3},{value:"Canary Deployment",id:"canary-deployment",level:3},{value:"Integration Types",id:"integration-types",level:2},{value:"Mapping Templates (AWS &amp; HTTP Integration)",id:"mapping-templates-aws--http-integration",level:3},{value:"Mapping Example: JSON to XML with SOAP",id:"mapping-example-json-to-xml-with-soap",level:4},{value:"Mapping Example: Query String parameters",id:"mapping-example-query-string-parameters",level:4},{value:"Open API spec",id:"open-api-spec",level:2},{value:"Request Validation",id:"request-validation",level:2},{value:"OpenAPI",id:"openapi",level:3},{value:"Caching API responses",id:"caching-api-responses",level:2},{value:"Cache Invalidation",id:"cache-invalidation",level:3},{value:"Usage Plans &amp; API Keys",id:"usage-plans--api-keys",level:2},{value:"Correct Order for API keys",id:"correct-order-for-api-keys",level:3},{value:"Logging &amp; Tracing",id:"logging--tracing",level:2},{value:"CloudWatch Metrics",id:"cloudwatch-metrics",level:3},{value:"Gateway Throttling",id:"gateway-throttling",level:2},{value:"Errors",id:"errors",level:2},{value:"CORS",id:"cors",level:2},{value:"HTTP API vs REST API",id:"http-api-vs-rest-api",level:2},{value:"WebSocket API",id:"websocket-api",level:2},{value:"Connecting to the API",id:"connecting-to-the-api",level:3},{value:"Client to Server Messaging",id:"client-to-server-messaging",level:3},{value:"Server to Client Messaging",id:"server-to-client-messaging",level:3},{value:"Connection URL Operations",id:"connection-url-operations",level:3},{value:"Routing",id:"routing",level:3}];function d(e){const n={code:"code",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"AWS Lambda + API Gateway: No infrastructure to manage"}),"\n",(0,a.jsx)(n.li,{children:"Support for the WebSocket Protocol"}),"\n",(0,a.jsx)(n.li,{children:"Handle API versioning (v1, v2\u2026)"}),"\n",(0,a.jsx)(n.li,{children:"Handle different environments (dev, test, prod\u2026)"}),"\n",(0,a.jsx)(n.li,{children:"Handle security (Authentication and Authorization)"}),"\n",(0,a.jsx)(n.li,{children:"Create API keys, handle request throttling"}),"\n",(0,a.jsx)(n.li,{children:"Swagger / Open API import to quickly define APIs"}),"\n",(0,a.jsx)(n.li,{children:"Transform and validate requests and responses"}),"\n",(0,a.jsx)(n.li,{children:"Generate SDK and API specifications"}),"\n",(0,a.jsx)(n.li,{children:"Cache API responses"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"architecture",children:"Architecture"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Create a single interface for all the microservices in your company"}),"\n",(0,a.jsx)(n.li,{children:"Use API endpoints with various resources"}),"\n",(0,a.jsx)(n.li,{children:"Apply a simple domain name and SSL certificates"}),"\n",(0,a.jsx)(n.li,{children:"Can apply forwarding and transformation rules at the API Gateway level"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"api-gateway-architecture",src:i(50938).A+"",width:"988",height:"853"})}),"\n",(0,a.jsx)(n.h2,{id:"integrations-high-level",children:"Integrations High Level"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Lambda Function","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Invoke Lambda function"}),"\n",(0,a.jsx)(n.li,{children:"Easy way to expose REST API backed by AWS Lambda"}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["HTTP","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Expose HTTP endpoints in the backend"}),"\n",(0,a.jsx)(n.li,{children:"Example: internal HTTP API on premise, Application Load Balancer\u2026"}),"\n",(0,a.jsx)(n.li,{children:"Why? Add rate limiting, caching, user authentications, API keys, etc\u2026"}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["AWS Service","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Expose any AWS API through the API Gateway"}),"\n",(0,a.jsx)(n.li,{children:"Example: start an AWS Step Function workflow, post a message to SQS"}),"\n",(0,a.jsx)(n.li,{children:"Why? Add authentication, deploy publicly, rate control\u2026"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"example-serverless-api",children:"Example: Serverless API"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"api-gateway-example",src:i(9169).A+"",width:"1540",height:"301"})}),"\n",(0,a.jsx)(n.h3,{id:"example-kinesis-data-streams",children:"Example: Kinesis Data Streams"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"kinesis-data-streams-api-gateway",src:i(53628).A+"",width:"1648",height:"249"})}),"\n",(0,a.jsx)(n.h2,{id:"endpoint-types",children:"Endpoint Types"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Edge-Optimized (default): For global clients","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Requests are routed through the CloudFront Edge locations (improves latency)"}),"\n",(0,a.jsx)(n.li,{children:"The API Gateway still lives in only one region"}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["Regional:","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"For clients within the same region"}),"\n",(0,a.jsx)(n.li,{children:"Could manually combine with CloudFront (more control over the caching strategies and the distribution)"}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["Private:","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Can only be accessed from your VPC using an interface VPC endpoint (ENI)"}),"\n",(0,a.jsx)(n.li,{children:"Use a resource policy to define access"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"security",children:"Security"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["User Authentication through","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"IAM Roles (useful for internal applications)"}),"\n",(0,a.jsx)(n.li,{children:"Cognito (identity for external users \u2013 example mobile users)"}),"\n",(0,a.jsx)(n.li,{children:"Custom Authorizer (your own logic)"}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["Custom Domain Name HTTPS security through integration with AWS Certificate Manager (ACM)","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"If using Edge-Optimized endpoint, then the certificate must be in us-east-1"}),"\n",(0,a.jsx)(n.li,{children:"If using Regional endpoint, the certificate must be in the API Gateway region"}),"\n",(0,a.jsx)(n.li,{children:"Must setup CNAME or A-alias record in Route 53"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"iam-permissions",children:"IAM Permissions"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Create an IAM policy authorization and attach to User / Role"}),"\n",(0,a.jsx)(n.li,{children:"Authentication = IAM | Authorization = IAM Policy"}),"\n",(0,a.jsx)(n.li,{children:"Good to provide access within AWS (EC2, Lambda, IAM users\u2026)"}),"\n",(0,a.jsx)(n.li,{children:"Leverages \u201cSig v4\u201d capability where IAM credential are in headers"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"security-iam-permissions",src:i(70320).A+"",width:"1168",height:"433"})}),"\n",(0,a.jsx)(n.h3,{id:"resource-policies",children:"Resource Policies"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Resource policies (similar to Lambda Resource Policy)"}),"\n",(0,a.jsx)(n.li,{children:"Allow for Cross Account Access (combined with IAM Security)"}),"\n",(0,a.jsx)(n.li,{children:"Allow for a specific source IP address"}),"\n",(0,a.jsx)(n.li,{children:"Allow for a VPC Endpoint"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"cognito-user-pools",children:"Cognito User Pools"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Cognito fully manages user lifecycle, token expires automatically"}),"\n",(0,a.jsx)(n.li,{children:"API gateway verifies identity automatically from AWS Cognito"}),"\n",(0,a.jsx)(n.li,{children:"No custom implementation required"}),"\n",(0,a.jsx)(n.li,{children:"Authentication = Cognito User Pools | Authorization = API Gateway Methods"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"cognito-user-pools",src:i(21632).A+"",width:"1174",height:"489"})}),"\n",(0,a.jsx)(n.h3,{id:"lambda-authorizer-formerly-custom-authorizers",children:"Lambda Authorizer (formerly Custom Authorizers)"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Token-based authorizer (bearer token) \u2013 ex JWT (JSON Web Token) or Oauth"}),"\n",(0,a.jsx)(n.li,{children:"Arequest parameter-based Lambda authorizer (headers, query string, stage var)"}),"\n",(0,a.jsx)(n.li,{children:"Lambda must return an IAM policy for the user, result policy is cached"}),"\n",(0,a.jsx)(n.li,{children:"Authentication = External | Authorization = Lambda function"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"lambda-authorizer",src:i(3574).A+"",width:"1588",height:"525"})}),"\n",(0,a.jsx)(n.h3,{id:"summary",children:"Summary"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["IAM:","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Great for users / roles already within your AWS account, + resource policy for cross account"}),"\n",(0,a.jsx)(n.li,{children:"Handle authentication + authorization"}),"\n",(0,a.jsx)(n.li,{children:"Leverages Signature v4"}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["Custom Authorizer:","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Great for 3rd party tokens"}),"\n",(0,a.jsx)(n.li,{children:"Very flexible in terms of what IAM policy is returned"}),"\n",(0,a.jsx)(n.li,{children:"Need to handle Authentication verification + Authorization in the Lambda function"}),"\n",(0,a.jsx)(n.li,{children:"Pay per Lambda invocation, results are cached"}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["Cognito User Pool:","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"You manage your own user pool (can be backed by Facebook, Google login etc\u2026)"}),"\n",(0,a.jsx)(n.li,{children:"No need to write any custom code"}),"\n",(0,a.jsx)(n.li,{children:"Must implement authorization in the backend"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"deployment-stages",children:"Deployment Stages"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Making changes in the API Gateway does not mean they\u2019re effective"}),"\n",(0,a.jsx)(n.li,{children:"You need to make a \u201cdeployment\u201d for them to be in effect"}),"\n",(0,a.jsx)(n.li,{children:"It\u2019s a common source of confusion"}),"\n",(0,a.jsx)(n.li,{children:"Changes are deployed to \u201cStages\u201d (as many as you want)"}),"\n",(0,a.jsx)(n.li,{children:"Use the naming you like for stages (dev, test, prod)"}),"\n",(0,a.jsx)(n.li,{children:"Each stage has its own configuration parameters"}),"\n",(0,a.jsx)(n.li,{children:"Stages can be rolled back as a history of deployments is kept"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"stages-v1-and-v2-api-breaking-change",children:"Stages v1 and v2 API breaking change"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"gateway-v1-v2",src:i(89256).A+"",width:"1645",height:"514"})}),"\n",(0,a.jsx)(n.h3,{id:"stage-variables",children:"Stage Variables"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Stage variables are like environment variables for API Gateway"}),"\n",(0,a.jsx)(n.li,{children:"Use them to change often changing configuration values"}),"\n",(0,a.jsxs)(n.li,{children:["They can be used in:","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Lambda function ARN"}),"\n",(0,a.jsx)(n.li,{children:"HTTP Endpoint"}),"\n",(0,a.jsx)(n.li,{children:"Parameter mapping templates"}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["Use cases:","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Configure HTTP endpoints your stages talk to (dev, test, prod\u2026)"}),"\n",(0,a.jsx)(n.li,{children:"Pass configuration parameters to AWS Lambda through mapping templates"}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.li,{children:"Stage variables are passed to the \u201dcontext\u201d object in AWS Lambda"}),"\n",(0,a.jsxs)(n.li,{children:["Format: ",(0,a.jsx)(n.code,{children:"${stageVariables.variableName}"})]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"stage-variables--lambda-aliases",children:"Stage Variables & Lambda Aliases"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"We create a stage variable to indicate the corresponding Lambda alias"}),"\n",(0,a.jsx)(n.li,{children:"Our API gateway will automatically invoke the right Lambda function!"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"stage-variables",src:i(38631).A+"",width:"1794",height:"624"})}),"\n",(0,a.jsx)(n.h3,{id:"canary-deployment",children:"Canary Deployment"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Possibility to enable canary deployments for any stage (usually prod)"}),"\n",(0,a.jsx)(n.li,{children:"Choose the % of traffic the canary channel receives"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"gateway-canary",src:i(11042).A+"",width:"1204",height:"343"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Metrics & Logs are separate (for better monitoring)"}),"\n",(0,a.jsx)(n.li,{children:"Possibility to override stage variables for canary"}),"\n",(0,a.jsx)(n.li,{children:"This is blue / green deployment with AWS Lambda & API Gateway"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"integration-types",children:"Integration Types"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Integration Type MOCK","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"API Gateway returns a response without sending the request to the backend"}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["Integration Type HTTP / AWS (Lambda & AWS Services)","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"you must configure both the integration request and integration response"}),"\n",(0,a.jsx)(n.li,{children:"Setup data mapping using mapping templates for the request & response"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"gateway-integration-types",src:i(64818).A+"",width:"1224",height:"279"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Integration Type AWS_PROXY (Lambda Proxy):","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"incoming request from the client is the input to Lambda"}),"\n",(0,a.jsx)(n.li,{children:"The function is responsible for the logic of request / response"}),"\n",(0,a.jsx)(n.li,{children:"No mapping template, headers, query string parameters\u2026 are passed as arguments"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"gateway-lambda-proxy",src:i(80932).A+"",width:"1629",height:"442"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Integration Type HTTP_PROXY","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"No mapping template"}),"\n",(0,a.jsx)(n.li,{children:"The HTTP request is passed to the backend"}),"\n",(0,a.jsx)(n.li,{children:"The HTTP response from the backend is forwarded by API Gateway"}),"\n",(0,a.jsx)(n.li,{children:"Possibility to add HTTP Headers if need be (ex: API key)"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"gateway-http-proxy",src:i(12025).A+"",width:"1435",height:"277"})}),"\n",(0,a.jsx)(n.h3,{id:"mapping-templates-aws--http-integration",children:"Mapping Templates (AWS & HTTP Integration)"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Mapping templates can be used to modify request / responses"}),"\n",(0,a.jsx)(n.li,{children:"Rename / Modify query string parameters"}),"\n",(0,a.jsx)(n.li,{children:"Modify body content"}),"\n",(0,a.jsx)(n.li,{children:"Add headers"}),"\n",(0,a.jsx)(n.li,{children:"Uses Velocity Template Language (VTL): for loop, if etc\u2026"}),"\n",(0,a.jsx)(n.li,{children:"Filter output results (remove unnecessary data)"}),"\n",(0,a.jsx)(n.li,{children:"Content-Type can be set to application/json or application/xml"}),"\n"]}),"\n",(0,a.jsx)(n.h4,{id:"mapping-example-json-to-xml-with-soap",children:"Mapping Example: JSON to XML with SOAP"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"SOAP API are XML based, whereas REST API are JSON based"}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"In this case, API Gateway should:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Extract data from the request: either path, payload or header"}),"\n",(0,a.jsx)(n.li,{children:"Build SOAP message based on request data (mapping template)"}),"\n",(0,a.jsx)(n.li,{children:"Call SOAP service and receive XML response"}),"\n",(0,a.jsx)(n.li,{children:"Transform XML response to desired format (like JSON), and respond to the user"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"gateway-mapping",src:i(49478).A+"",width:"1408",height:"300"})}),"\n",(0,a.jsx)(n.h4,{id:"mapping-example-query-string-parameters",children:"Mapping Example: Query String parameters"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"gateway-mapping-query",src:i(63453).A+"",width:"1378",height:"838"})}),"\n",(0,a.jsx)(n.h2,{id:"open-api-spec",children:"Open API spec"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Common way of defining REST APIs, using API definition as code"}),"\n",(0,a.jsxs)(n.li,{children:["Import existing OpenAPI 3.0 spec to API Gateway","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Method"}),"\n",(0,a.jsx)(n.li,{children:"Method Request"}),"\n",(0,a.jsx)(n.li,{children:"Integration Request"}),"\n",(0,a.jsx)(n.li,{children:"Method Response"}),"\n",(0,a.jsx)(n.li,{children:"+ AWS extensions for API gateway and setup every single option"}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.li,{children:"Can export current API as OpenAPI spec"}),"\n",(0,a.jsx)(n.li,{children:"OpenAPI specs can be written in YAML or JSON"}),"\n",(0,a.jsx)(n.li,{children:"Using OpenAPI we can generate SDK for our applications"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"request-validation",children:"Request Validation"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"You can configure API Gateway to perform basic validation of an API request before proceeding with the integration request"}),"\n",(0,a.jsxs)(n.li,{children:["When the validation fails, API Gateway immediately fails the request","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Returns a 400-error response to the caller"}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.li,{children:"This reduces unnecessary calls to the backend"}),"\n",(0,a.jsxs)(n.li,{children:["Checks:","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"The required request parameters in the URI, query string, and headers of an incoming request are included and non-blank"}),"\n",(0,a.jsx)(n.li,{children:"The applicable request payload adheres to the configured JSON Schema request model of the method"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"openapi",children:"OpenAPI"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Setup request validation by importing OpenAPI definitions file"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"openapi-request-validation",src:i(86577).A+"",width:"1716",height:"676"})}),"\n",(0,a.jsx)(n.h2,{id:"caching-api-responses",children:"Caching API responses"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Caching reduces the number of calls made to the backend"}),"\n",(0,a.jsx)(n.li,{children:"Default TTL (time to live) is 300 seconds (min: 0s, max: 3600s)"}),"\n",(0,a.jsx)(n.li,{children:"Caches are defined per stage"}),"\n",(0,a.jsx)(n.li,{children:"Possible to override cache settings per method"}),"\n",(0,a.jsx)(n.li,{children:"Cache encryption option"}),"\n",(0,a.jsx)(n.li,{children:"Cache capacity between 0.5GB to 237GB"}),"\n",(0,a.jsx)(n.li,{children:"Cache is expensive, makes sense in production, may not make sense in dev / test"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"gateway-caching",src:i(10976).A+"",width:"661",height:"813"})}),"\n",(0,a.jsx)(n.h3,{id:"cache-invalidation",children:"Cache Invalidation"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Able to flush the entire cache (invalidate it) immediately"}),"\n",(0,a.jsx)(n.li,{children:"Clients can invalidate the cache with header: CacheControl: max-age=0 (with proper IAM authorization)"}),"\n",(0,a.jsx)(n.li,{children:"If you don't impose an InvalidateCache policy (or choose the Require authorization check box in the console), any client can invalidate the API cache"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"usage-plans--api-keys",children:"Usage Plans & API Keys"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"If you want to make an API available as an offering ($) to your customers"}),"\n",(0,a.jsxs)(n.li,{children:["Usage Plan:","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"who can access one or more deployed API stages and methods"}),"\n",(0,a.jsx)(n.li,{children:"how much and how fast they can access them"}),"\n",(0,a.jsx)(n.li,{children:"uses API keys to identify API clients and meter access"}),"\n",(0,a.jsx)(n.li,{children:"configure throttling limits and quota limits that are enforced on individual client"}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["API Keys:","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"alphanumeric string values to distribute to your customers"}),"\n",(0,a.jsx)(n.li,{children:"Ex: WBjHxNtoAb4WPKBC7cGm64CBibIb24b4jt8jJHo9"}),"\n",(0,a.jsx)(n.li,{children:"Can use with usage plans to control access"}),"\n",(0,a.jsx)(n.li,{children:"Throttling limits are applied to the API keys"}),"\n",(0,a.jsx)(n.li,{children:"Quotas limits is the overall number of maximum requests"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"correct-order-for-api-keys",children:"Correct Order for API keys"}),"\n",(0,a.jsx)(n.p,{children:"To configure a usage plan:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"Create one or more APIs, configure the methods to require an API key, and deploy the APIs to stages."}),"\n",(0,a.jsx)(n.li,{children:"Generate or import API keys to distribute to application developers (your customers) who will be using your API."}),"\n",(0,a.jsx)(n.li,{children:"Create the usage plan with the desired throttle and quota limits."}),"\n",(0,a.jsx)(n.li,{children:"Associate API stages and API keys with the usage plan."}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Callers of the API must supply an assigned API key in the x-api-key header in requests to the API."}),"\n",(0,a.jsx)(n.h2,{id:"logging--tracing",children:"Logging & Tracing"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["CloudWatch Logs","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Log contains information about request/response body"}),"\n",(0,a.jsx)(n.li,{children:"Enable CloudWatch logging at the Stage level (with Log Level - ERROR, DEBUG, INFO)"}),"\n",(0,a.jsx)(n.li,{children:"Can override settings on a per API basis"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"gateway-logging",src:i(76655).A+"",width:"948",height:"358"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["X-Ray","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Enable tracing to get extra information about requests in API Gateway"}),"\n",(0,a.jsx)(n.li,{children:"X-Ray API Gateway + AWS Lambda gives you the full picture"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"cloudwatch-metrics",children:"CloudWatch Metrics"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Metrics are by stage, Possibility to enable detailed metrics"}),"\n",(0,a.jsx)(n.li,{children:"CacheHitCount & CacheMissCount: efficiency of the cache"}),"\n",(0,a.jsx)(n.li,{children:"Count: The total number API requests in a given period."}),"\n",(0,a.jsx)(n.li,{children:"IntegrationLatency: The time between when API Gateway relays a request to the backend and when it receives a response from the backend."}),"\n",(0,a.jsx)(n.li,{children:"Latency: The time between when API Gateway receives a request from a client and when it returns a response to the client. The latency includes the integration latency and other API Gateway overhead."}),"\n",(0,a.jsx)(n.li,{children:"4XXError (client-side) & 5XXError (server-side)"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"gateway-throttling",children:"Gateway Throttling"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Account Limit","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"API Gateway throttles requests at10000 rps across all API"}),"\n",(0,a.jsx)(n.li,{children:"Soft limit that can be increased upon request"}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.li,{children:"In case of throttling => 429 Too Many Requests (retriable error)"}),"\n",(0,a.jsx)(n.li,{children:"Can set Stage limit & Method limits to improve performance"}),"\n",(0,a.jsx)(n.li,{children:"Or you can define Usage Plans to throttle per customer"}),"\n",(0,a.jsx)(n.li,{children:"Just like Lambda Concurrency, one API that is overloaded, if not limited, can cause the other APIs to be throttled"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"errors",children:"Errors"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["4xx means Client errors","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"400: Bad Request"}),"\n",(0,a.jsx)(n.li,{children:"403: Access Denied, WAF filtered"}),"\n",(0,a.jsx)(n.li,{children:"429: Quota exceeded, Throttle"}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["5xx means Server errors","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"502: Bad Gateway Exception, usually for an incompatible output returned from a Lambda proxy integration backend and occasionally for out-of-order invocations due to heavy loads."}),"\n",(0,a.jsx)(n.li,{children:"503: Service Unavailable Exception"}),"\n",(0,a.jsx)(n.li,{children:"504: Integration Failure \u2013 ex Endpoint Request Timed-out Exception API Gateway requests time out after 29 second maximum"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"cors",children:"CORS"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"CORS must be enabled when you receive API calls from another domain"}),"\n",(0,a.jsxs)(n.li,{children:["The OPTIONS pre-flight request must contain the following headers:","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Access-Control-Allow-Methods"}),"\n",(0,a.jsx)(n.li,{children:"Access-Control-Allow-Headers"}),"\n",(0,a.jsx)(n.li,{children:"Access-Control-Allow-Origin"}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.li,{children:"CORS can be enabled through the console"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"gateway-cors",src:i(77413).A+"",width:"1846",height:"799"})}),"\n",(0,a.jsx)(n.h2,{id:"http-api-vs-rest-api",children:"HTTP API vs REST API"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["HTTP APIs","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.strong,{children:"very cheap"})}),"\n",(0,a.jsx)(n.li,{children:"low-latency, cost-effective AWS Lambda proxy, HTTP proxy APIs and private integration (no data mapping)"}),"\n",(0,a.jsx)(n.li,{children:"support OIDC and OAuth 2.0 authorization, and built-in support for CORS"}),"\n",(0,a.jsx)(n.li,{children:"No usage plans and API keys"}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["REST APIs","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"All features (except Native OpenID Connect / OAuth 2.0)"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"gateway-http-vs-rest",src:i(87649).A+"",width:"805",height:"400"})}),"\n",(0,a.jsx)(n.h2,{id:"websocket-api",children:"WebSocket API"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["What\u2019s WebSocket?","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Two-way interactive communication between a user\u2019s browser and a server"}),"\n",(0,a.jsx)(n.li,{children:"Server can push information to the client"}),"\n",(0,a.jsx)(n.li,{children:"This enables stateful application use cases"}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.li,{children:"WebSocket APIs are often used in realtime applications such as chat applications, collaboration platforms, multiplayer games, and financial trading platforms"}),"\n",(0,a.jsx)(n.li,{children:"Works with AWS Services (Lambda, DynamoDB) or HTTP endpoints"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"gateway-websocket",src:i(58813).A+"",width:"796",height:"853"})}),"\n",(0,a.jsx)(n.h3,{id:"connecting-to-the-api",children:"Connecting to the API"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"gateway-websocket-connecting",src:i(69598).A+"",width:"1675",height:"453"})}),"\n",(0,a.jsx)(n.h3,{id:"client-to-server-messaging",children:"Client to Server Messaging"}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"ConnectionID"})," is re-used:"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"websocket-gateway-client-to-server",src:i(3499).A+"",width:"1714",height:"454"})}),"\n",(0,a.jsx)(n.h3,{id:"server-to-client-messaging",children:"Server to Client Messaging"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"gateway-server-to-client",src:i(60305).A+"",width:"1689",height:"748"})}),"\n",(0,a.jsx)(n.h3,{id:"connection-url-operations",children:"Connection URL Operations"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"gateway-websocket-url-operations",src:i(84634).A+"",width:"1506",height:"517"})}),"\n",(0,a.jsx)(n.h3,{id:"routing",children:"Routing"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Incoming JSON messages are routed to different backend"}),"\n",(0,a.jsx)(n.li,{children:"If no routes => sent to $default"}),"\n",(0,a.jsx)(n.li,{children:"You request a route selection expression to select the field on JSON to route from"}),"\n",(0,a.jsxs)(n.li,{children:["Sample expression: ",(0,a.jsx)(n.code,{children:"$request.body.action"})]}),"\n",(0,a.jsx)(n.li,{children:"The result is evaluated against the route keys available in your API Gateway"}),"\n",(0,a.jsx)(n.li,{children:"The route is then connected to the backend you\u2019ve setup through API Gateway"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"gateway-websocket-routing",src:i(81936).A+"",width:"655",height:"835"})})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},50938:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/api-gateway-architecture-7e8cfcde6a1f00534aba959b8735efd2.png"},9169:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/api-gateway-example-69d4ccceb535c1753a19a75408f0b1cd.png"},21632:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/cognito-user-pools-db5392c12837195ca09e6f3adb7808c6.png"},10976:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/gateway-caching-c5d4ca5796851e569e4e739cab608504.png"},11042:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/gateway-canary-ae53783a6a78f3f380b164c549539b51.png"},77413:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/gateway-cors-34bb9328534a6bb55d735769f5bb814b.png"},12025:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/gateway-http-proxy-861d296b22fb2a8e8327824f597b0f72.png"},87649:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/gateway-http-vs-rest-41e45aa91349604c10ee0787b253b31f.png"},64818:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/gateway-integration-types-8be428d5b3ff6dfc819842f6d734d63f.png"},80932:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/gateway-lambda-proxy-00f2a8489752d56daa94f894b0a9b791.png"},76655:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/gateway-logging-1830f45c9afa74de683258e7bdb41839.png"},63453:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/gateway-mapping-query-54bd134dbe694299ba7c9c0ed99f9224.png"},49478:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/gateway-mapping-955efd25c7f68b4387cb242c7e7be720.png"},60305:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/gateway-server-to-client-ffc86b32deeae3fd50474e81b0371eec.png"},89256:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/gateway-v1-v2-c2705a6f22a3db40f1b4376b3dc0ca00.png"},69598:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/gateway-websocket-connecting-999b2c736d803ea77675acfc3b6aee69.png"},81936:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/gateway-websocket-routing-8f75d28e68f2799646bc186d5f19f0ff.png"},84634:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/gateway-websocket-url-operations-b44f02c9587b6a2410d7caee0ea1af50.png"},58813:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/gateway-websocket-a69ce74b976dba12d828ea46beddfb16.png"},53628:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/kinesis-data-streams-api-gateway-1c4307c871e300c94e36631969b0b0f0.png"},3574:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/lambda-authorizer-884c1a2183176f027dacdcbf1816809f.png"},86577:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/openapi-request-validation-c5e82536c94ebf033e043ded629016fe.png"},70320:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/security-iam-permissions-c584cda63ad0976f9d19ec1ff2e875af.png"},38631:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/stage-variables-85b1c16b9824f015f961e30c3f111de4.png"},3499:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/websocket-gateway-client-to-server-bf5811f15d12b00cc681f61c10e74075.png"},28453:(e,n,i)=>{i.d(n,{R:()=>l,x:()=>r});var s=i(96540);const a={},t=s.createContext(a);function l(e){const n=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:l(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);