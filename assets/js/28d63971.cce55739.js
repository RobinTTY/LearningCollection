"use strict";(globalThis.webpackChunklearning_knowledge_base=globalThis.webpackChunklearning_knowledge_base||[]).push([[9235],{98831:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>r,default:()=>h,frontMatter:()=>t,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"cloud/aws/certified-developer-associate/lambda","title":"Lambda","description":"- Virtual functions \u2013 no servers to manage!","source":"@site/docs/cloud/aws/certified-developer-associate/lambda.md","sourceDirName":"cloud/aws/certified-developer-associate","slug":"/cloud/aws/certified-developer-associate/lambda","permalink":"/LearningCollection/cloud/aws/certified-developer-associate/lambda","draft":false,"unlisted":false,"editUrl":"https://github.com/RobinTTY/LearningCollection/tree/master/website/docs/cloud/aws/certified-developer-associate/lambda.md","tags":[],"version":"current","sidebarPosition":17,"frontMatter":{"title":"Lambda","sidebar_position":17},"sidebar":"docs","previous":{"title":"Monitoring, Troubleshooting & Audit","permalink":"/LearningCollection/cloud/aws/certified-developer-associate/monitoring-troubleshooting-audit"},"next":{"title":"DynamoDB","permalink":"/LearningCollection/cloud/aws/certified-developer-associate/dynamodb"}}');var a=i(74848),l=i(28453);const t={title:"Lambda",sidebar_position:17},r=void 0,o={},c=[{value:"Benefits of AWS Lambda",id:"benefits-of-aws-lambda",level:2},{value:"Synchronous Invocations",id:"synchronous-invocations",level:2},{value:"Lambda Integration with ALB",id:"lambda-integration-with-alb",level:3},{value:"ALB Multi-Header Values",id:"alb-multi-header-values",level:4},{value:"ALB + Lambda \u2013 Permissios",id:"alb--lambda--permissios",level:4},{value:"Asynchronous Invocations",id:"asynchronous-invocations",level:2},{value:"Services",id:"services",level:3},{value:"CloudWatch Events / EventBridge",id:"cloudwatch-events--eventbridge",level:3},{value:"S3 Events Notifications",id:"s3-events-notifications",level:3},{value:"Lambda \u2013 Event Source Mapping",id:"lambda--event-source-mapping",level:2},{value:"Event Source Mapping SQS &amp; SQS FIFO",id:"event-source-mapping-sqs--sqs-fifo",level:3},{value:"Streams &amp; Lambda (Kinesis &amp; DynamoDB)",id:"streams--lambda-kinesis--dynamodb",level:2},{value:"Error Handling",id:"error-handling",level:3},{value:"Queues &amp; Lambda",id:"queues--lambda",level:2},{value:"Lambda Event Mapper Scaling",id:"lambda-event-mapper-scaling",level:3},{value:"Event and Context Objects",id:"event-and-context-objects",level:2},{value:"Destinations",id:"destinations",level:2},{value:"Lambda Execution Role (IAM Role)",id:"lambda-execution-role-iam-role",level:2},{value:"Resource Based Policies",id:"resource-based-policies",level:3},{value:"Environment Variables",id:"environment-variables",level:2},{value:"Logging &amp; Monitoring",id:"logging--monitoring",level:2},{value:"Tracing with X-Ray",id:"tracing-with-x-ray",level:3},{value:"CloudFront Functions &amp; Lambda@Edge",id:"cloudfront-functions--lambdaedge",level:2},{value:"CloudFront Functions",id:"cloudfront-functions",level:3},{value:"Lambda@Edge",id:"lambdaedge",level:3},{value:"CloudFront Functions vs. Lambda@Edge",id:"cloudfront-functions-vs-lambdaedge",level:3},{value:"Use Cases",id:"use-cases",level:3},{value:"Lambda and VPCs",id:"lambda-and-vpcs",level:2},{value:"Internet Access",id:"internet-access",level:3},{value:"Lambda Function Configuration",id:"lambda-function-configuration",level:2},{value:"Lambda Execution Context",id:"lambda-execution-context",level:2},{value:"Initialize outside the handler",id:"initialize-outside-the-handler",level:3},{value:"/tmp space",id:"tmp-space",level:3},{value:"Lambda Layers",id:"lambda-layers",level:2},{value:"File Systems Mounting",id:"file-systems-mounting",level:2},{value:"Storage Options",id:"storage-options",level:3},{value:"Concurrency and Throttling",id:"concurrency-and-throttling",level:2},{value:"Concurrency and Asynchronous Invocations",id:"concurrency-and-asynchronous-invocations",level:3},{value:"Cold Starts &amp; Provisioned Concurrency",id:"cold-starts--provisioned-concurrency",level:2},{value:"Misc",id:"misc",level:2},{value:"Lambda Function Dependencies",id:"lambda-function-dependencies",level:3},{value:"Lambda and CloudFormation \u2013 inline",id:"lambda-and-cloudformation--inline",level:3},{value:"Lambda and CloudFormation \u2013 through S3",id:"lambda-and-cloudformation--through-s3",level:3},{value:"Lambda Container Images",id:"lambda-container-images",level:2},{value:"Best Practices",id:"best-practices",level:3},{value:"AWS Lambda Versions &amp; Aliases",id:"aws-lambda-versions--aliases",level:2},{value:"Versions",id:"versions",level:3},{value:"Aliases",id:"aliases",level:3},{value:"Lambda &amp; CodeDeploy",id:"lambda--codedeploy",level:2},{value:"AppSpec.yml",id:"appspecyml",level:3},{value:"Function URL",id:"function-url",level:2},{value:"Security",id:"security",level:3},{value:"Lambda and CodeGuru Profiling",id:"lambda-and-codeguru-profiling",level:2},{value:"Lambda Limits to Know - per region",id:"lambda-limits-to-know---per-region",level:2},{value:"AWS Lambda Best Practices",id:"aws-lambda-best-practices",level:2}];function d(e){const n={code:"code",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",p:"p",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Virtual functions \u2013 no servers to manage!"}),"\n",(0,a.jsx)(n.li,{children:"Limited by time - short executions"}),"\n",(0,a.jsx)(n.li,{children:"Run on-demand"}),"\n",(0,a.jsx)(n.li,{children:"Scaling is automated"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Example: Serverless Thumbnail creation:"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"lambda-simple-example",src:i(25316).A+"",width:"611",height:"266"})}),"\n",(0,a.jsx)(n.h2,{id:"benefits-of-aws-lambda",children:"Benefits of AWS Lambda"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Easy Pricing:","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Pay per request and compute time ($0.20 per 1 million requests, $1.00 for 600,000 GB-seconds)"}),"\n",(0,a.jsx)(n.li,{children:"Free tier of 1,000,000 AWS Lambda requests and 400,000 GBs of compute time (1GB RAM)"}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.li,{children:"Integrated with the whole AWS suite of services"}),"\n",(0,a.jsx)(n.li,{children:"Integrated with many programming languages"}),"\n",(0,a.jsx)(n.li,{children:"Easy monitoring through AWS CloudWatch"}),"\n",(0,a.jsx)(n.li,{children:"Easy to get more resources per functions (up to 10GB of RAM!)"}),"\n",(0,a.jsx)(n.li,{children:"Increasing RAM will also improve CPU and network!"}),"\n",(0,a.jsx)(n.li,{children:"Language Support: Node.js (JavaScript), Python, Java, C# (.NET Core) / Powershell,Ruby, Custom Runtime API (community supported, example Rust or Golang), Lambda Container Image (must implement the Lambda Runtime API)"}),"\n",(0,a.jsx)(n.li,{children:"Integrates with many other AWS Services (API Gateway, Kinesis, DynamoDB, S3, CloudFront, Cloudwatch Events EventBridge, CloudWatch Logs, SNS, SQS, Cognito, etc.)"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"synchronous-invocations",children:"Synchronous Invocations"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"lambda-synchronous-invocations",src:i(43298).A+"",width:"635",height:"255"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["User Invoked:","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Elastic Load Balancing (Application Load Balancer)"}),"\n",(0,a.jsx)(n.li,{children:"Amazon API Gateway"}),"\n",(0,a.jsx)(n.li,{children:"Amazon CloudFront (Lambda@Edge)"}),"\n",(0,a.jsx)(n.li,{children:"Amazon S3 Batch"}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["Service Invoked:","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Amazon Cognito"}),"\n",(0,a.jsx)(n.li,{children:"AWS Step Functions"}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["Other Services:","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Amazon Lex"}),"\n",(0,a.jsx)(n.li,{children:"Amazon Alexa"}),"\n",(0,a.jsx)(n.li,{children:"Amazon Kinesis Data Firehose"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"lambda-integration-with-alb",children:"Lambda Integration with ALB"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"To expose a Lambda function as an HTTP(S) endpoint\u2026"}),"\n",(0,a.jsx)(n.li,{children:"You can use the Application Load Balancer (or an API Gateway)"}),"\n",(0,a.jsx)(n.li,{children:"The Lambda function must be registered in a target group"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"alb-to-lambda",src:i(74264).A+"",width:"596",height:"720"})}),"\n",(0,a.jsx)(n.h4,{id:"alb-multi-header-values",children:"ALB Multi-Header Values"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"ALB can support multi header values (ALB setting)"}),"\n",(0,a.jsx)(n.li,{children:"When you enable multi-value headers, HTTP headers and query string parameters that are sent with multiple values are shown as arrays within the AWS Lambda event and response objects"}),"\n"]}),"\n",(0,a.jsx)(n.h4,{id:"alb--lambda--permissios",children:"ALB + Lambda \u2013 Permissios"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"alb-lambda-permissions",src:i(66463).A+"",width:"502",height:"194"})}),"\n",(0,a.jsx)(n.h2,{id:"asynchronous-invocations",children:"Asynchronous Invocations"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"S3, SNS, CloudWatch Events\u2026"}),"\n",(0,a.jsx)(n.li,{children:"The events are placed in an Event Queue"}),"\n",(0,a.jsxs)(n.li,{children:["Lambda attempts to retry on errors","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"3 tries total, 1 minute wait after first then 2 minute wait"}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.li,{children:"Make sure the processing is idempotent (in case of retries)"}),"\n",(0,a.jsx)(n.li,{children:"If the function is retried, you will see duplicate logs entries in CloudWatch Logs"}),"\n",(0,a.jsx)(n.li,{children:"Can define a DLQ (dead-letter queue) \u2013 SNS or SQS \u2013 for failed processing (need correct IAM permissions)"}),"\n",(0,a.jsx)(n.li,{children:"Asynchronous invocations allow you to speed up the processing if you don\u2019t need to wait for the result (ex: you need 1000 files processed)"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"lambda-async",src:i(37483).A+"",width:"877",height:"784"})}),"\n",(0,a.jsx)(n.h3,{id:"services",children:"Services"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.strong,{children:"Amazon Simple Storage Service (S3)"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.strong,{children:"Amazon Simple Notification Service (SNS)"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.strong,{children:"Amazon CloudWatch Events / EventBridge"})}),"\n",(0,a.jsx)(n.li,{children:"AWS CodeCommit"}),"\n",(0,a.jsx)(n.li,{children:"AWS CodePipeline"}),"\n",(0,a.jsx)(n.li,{children:"and more"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"cloudwatch-events--eventbridge",children:"CloudWatch Events / EventBridge"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"cloudwatch-events",src:i(13051).A+"",width:"1504",height:"696"})}),"\n",(0,a.jsx)(n.h3,{id:"s3-events-notifications",children:"S3 Events Notifications"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["S3",":ObjectCreated",", S3",":ObjectRemoved",", S3",":ObjectRestore",", S3",":Replication","\u2026"]}),"\n",(0,a.jsx)(n.li,{children:"Object name filtering possible (*.jpg)"}),"\n",(0,a.jsx)(n.li,{children:"Use case: generate thumbnails of images uploaded to S3"}),"\n",(0,a.jsx)(n.li,{children:"S3 event notifications typically deliver events in seconds but can sometimes take a minute or longer"}),"\n",(0,a.jsx)(n.li,{children:"If two writes are made to a single non versioned object at the same time, it is possible that only a single event notification will be sent"}),"\n",(0,a.jsx)(n.li,{children:"If you want to ensure that an event notification is sent for every successful write, you can enable versioning on your bucket."}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"lambda-event-notifications",src:i(40908).A+"",width:"853",height:"904"})}),"\n",(0,a.jsx)(n.h2,{id:"lambda--event-source-mapping",children:"Lambda \u2013 Event Source Mapping"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Kinesis Data Streams"}),"\n",(0,a.jsx)(n.li,{children:"SQS & SQS FIFO queue"}),"\n",(0,a.jsx)(n.li,{children:"DynamoDB Streams"}),"\n",(0,a.jsx)(n.li,{children:"Common denominator: records need to be polled from the source"}),"\n",(0,a.jsx)(n.li,{children:"Your Lambda function is invoked synchronously"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"lambda-event-source",src:i(64713).A+"",width:"865",height:"783"})}),"\n",(0,a.jsx)(n.h3,{id:"event-source-mapping-sqs--sqs-fifo",children:"Event Source Mapping SQS & SQS FIFO"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"sqs-sqs-fifo",src:i(72071).A+"",width:"1723",height:"715"})}),"\n",(0,a.jsx)(n.h2,{id:"streams--lambda-kinesis--dynamodb",children:"Streams & Lambda (Kinesis & DynamoDB)"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"An event source mapping creates an iterator for each shard, processes items in order"}),"\n",(0,a.jsx)(n.li,{children:"Start with new items, from the beginning or from timestamp"}),"\n",(0,a.jsx)(n.li,{children:"Processed items aren't removed from the stream (other consumers can read them)"}),"\n",(0,a.jsx)(n.li,{children:"Low traffic: use batch window to accumulate records before processing"}),"\n",(0,a.jsx)(n.li,{children:"You can process multiple batches in parallel"}),"\n",(0,a.jsx)(n.li,{children:"up to 10 batches per shard"}),"\n",(0,a.jsx)(n.li,{children:"in-order processing is still guaranteed for each partition key"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"streams-lambda",src:i(75616).A+"",width:"1096",height:"325"})}),"\n",(0,a.jsx)(n.h3,{id:"error-handling",children:"Error Handling"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"By default, if your function returns an error, the entire batch is reprocessed until the function succeeds, or the items in the batch expire"}),"\n",(0,a.jsx)(n.li,{children:"To ensure in-order processing, processing for the affected shard is paused until the error is resolved"}),"\n",(0,a.jsxs)(n.li,{children:["You can configure the event source mapping to:","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"discard old events"}),"\n",(0,a.jsx)(n.li,{children:"restrict the number of retries"}),"\n",(0,a.jsx)(n.li,{children:"split the batch on error (to work around Lambda timeout issues)"}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.li,{children:"Discarded events can go to a Destination"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"queues--lambda",children:"Queues & Lambda"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Lambda also supports in-order processing for FIFO (first-in, first-out) queues, scaling up to the number of active message groups."}),"\n",(0,a.jsx)(n.li,{children:"For standard queues, items aren't necessarily processed in order."}),"\n",(0,a.jsx)(n.li,{children:"Lambda scales up to process a standard queue as quickly as possible."}),"\n",(0,a.jsx)(n.li,{children:"When an error occurs, batches are returned to the queue as individual items and might be processed in a different grouping than the original batch."}),"\n",(0,a.jsx)(n.li,{children:"Occasionally, the event source mapping might receive the same item from the queue twice, even if no function error occurred."}),"\n",(0,a.jsx)(n.li,{children:"Lambda deletes items from the queue after they're processed successfully."}),"\n",(0,a.jsx)(n.li,{children:"You can configure the source queue to send items to a dead-letter queue if they can't be processed."}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"lambda-event-mapper-scaling",children:"Lambda Event Mapper Scaling"}),"\n",(0,a.jsx)(n.p,{children:"Kinesis Data Streams & DynamoDB Streams:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"One Lambda invocation per stream shard"}),"\n",(0,a.jsx)(n.li,{children:"If you use parallelization, up to 10 batches processed per shard simultaneously"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"SQS Standard:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Lambda adds 60 more instances per minute to scale up"}),"\n",(0,a.jsx)(n.li,{children:"Up to 1000 batches of messages processed simultaneously"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"SQS FIFO:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Messages with the same GroupID will be processed in order"}),"\n",(0,a.jsx)(n.li,{children:"The Lambda function scales to the number of active message groups"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"event-and-context-objects",children:"Event and Context Objects"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"lambda-event-context",src:i(40997).A+"",width:"1765",height:"769"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Event Object","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"JSON-formatted document contains data for the function to process"}),"\n",(0,a.jsx)(n.li,{children:"Contains information from the invoking service (e.g., EventBridge, custom, \u2026)"}),"\n",(0,a.jsx)(n.li,{children:"Lambda runtime converts the event to an object (e.g., dict type in Python)"}),"\n",(0,a.jsx)(n.li,{children:"Example: input arguments, invoking service arguments, \u2026"}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["Context Object","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Provides methods and properties that provide information about the invocation, function, and runtime environment"}),"\n",(0,a.jsx)(n.li,{children:"Passed to your function by Lambda at runtime"}),"\n",(0,a.jsx)(n.li,{children:"Example: aws_request_id, function_name, memory_limit_in_mb, \u2026"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"destinations",children:"Destinations"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Nov 2019: Can configure to send result to a destination"}),"\n",(0,a.jsxs)(n.li,{children:["Asynchronous invocations - can define destinations for successful and failed event:","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Amazon SQS"}),"\n",(0,a.jsx)(n.li,{children:"Amazon SNS"}),"\n",(0,a.jsx)(n.li,{children:"AWS Lambda"}),"\n",(0,a.jsx)(n.li,{children:"Amazon EventBridge bus"}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.li,{children:"Note: AWS recommends you use destinations instead of DLQ now (but both can be used at the same time)"}),"\n",(0,a.jsxs)(n.li,{children:["Event Source mapping: for discarded event batches","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Amazon SQS"}),"\n",(0,a.jsx)(n.li,{children:"Amazon SNS"}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.li,{children:"Note: you can send events to a DLQ directly from SQS"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"lambda-destinations",src:i(20156).A+"",width:"624",height:"829"})}),"\n",(0,a.jsx)(n.h2,{id:"lambda-execution-role-iam-role",children:"Lambda Execution Role (IAM Role)"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Grants the Lambda function permissions to AWS services / resources"}),"\n",(0,a.jsxs)(n.li,{children:["Sample managed policies for Lambda:","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"AWSLambdaBasicExecutionRole\u2013 Upload logs to CloudWatch."}),"\n",(0,a.jsx)(n.li,{children:"AWSLambdaKinesisExecutionRole\u2013 Read from Kinesis"}),"\n",(0,a.jsx)(n.li,{children:"AWSLambdaDynamoDBExecutionRole\u2013 Read from DynamoDB Streams"}),"\n",(0,a.jsx)(n.li,{children:"AWSLambdaSQSQueueExecutionRole\u2013 Read from SQS"}),"\n",(0,a.jsx)(n.li,{children:"AWSLambdaVPCAccessExecutionRole\u2013 Deploy Lambda function in VPC"}),"\n",(0,a.jsx)(n.li,{children:"AWSXRayDaemonWriteAccess\u2013 Upload trace data to X-Ray."}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.li,{children:"When you use an event source mapping to invoke your function, Lambda uses the execution role to read event data."}),"\n",(0,a.jsx)(n.li,{children:"Best practice: create one Lambda Execution Role per function"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"resource-based-policies",children:"Resource Based Policies"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Use resource-based policies to give other accounts and AWS services permission to use your Lambda resources"}),"\n",(0,a.jsx)(n.li,{children:"Similar to S3 bucket policies for S3 bucket"}),"\n",(0,a.jsxs)(n.li,{children:["An IAM principal can access Lambda:","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"if the IAM policy attached to the principal authorizes it (e.g. user access)"}),"\n",(0,a.jsx)(n.li,{children:"OR if the resource-based policy authorizes (e.g. service access)"}),"\n",(0,a.jsx)(n.li,{children:"When an AWS service like Amazon S3 calls your Lambda function, the resource-based policy gives it access."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"environment-variables",children:"Environment Variables"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Environment variable = key / value pair in \u201cString\u201d form"}),"\n",(0,a.jsx)(n.li,{children:"Adjust the function behavior without updating code"}),"\n",(0,a.jsx)(n.li,{children:"The environment variables are available to your code"}),"\n",(0,a.jsx)(n.li,{children:"Lambda Service adds its own system environment variables as well"}),"\n",(0,a.jsx)(n.li,{children:"Helpful to store secrets (encrypted by KMS)"}),"\n",(0,a.jsx)(n.li,{children:"Secrets can be encrypted by the Lambda service key, or your own CMK"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"logging--monitoring",children:"Logging & Monitoring"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["CloudWatch Logs:","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"AWS Lambda execution logs are stored in AWS CloudWatch Logs"}),"\n",(0,a.jsx)(n.li,{children:"Make sure your AWS Lambda function has an execution role with an IAM policy that authorizes writes to CloudWatch Logs"}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["CloudWatch Metrics:","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"AWS Lambda metrics are displayed in AWS CloudWatch Metrics"}),"\n",(0,a.jsx)(n.li,{children:"Invocations, Durations, Concurrent Executions"}),"\n",(0,a.jsx)(n.li,{children:"Error count, Success Rates, Throttles"}),"\n",(0,a.jsx)(n.li,{children:"Async Delivery Failures"}),"\n",(0,a.jsx)(n.li,{children:"Iterator Age (Kinesis & DynamoDB Streams)"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"tracing-with-x-ray",children:"Tracing with X-Ray"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Enable in Lambda configuration (Active Tracing)"}),"\n",(0,a.jsx)(n.li,{children:"Runs the X-Ray daemon for you"}),"\n",(0,a.jsx)(n.li,{children:"Use AWS X-Ray SDK in Code"}),"\n",(0,a.jsxs)(n.li,{children:["Ensure Lambda Function has a correct IAM Execution Role","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"The managed policy is called AWSXRayDaemonWriteAccess"}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["Environment variables to communicate with X-Ray","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"_X_AMZN_TRACE_ID: contains the tracing header"}),"\n",(0,a.jsx)(n.li,{children:"AWS_XRAY_CONTEXT_MISSING: by default, LOG_ERROR"}),"\n",(0,a.jsxs)(n.li,{children:["AWS_XRAY_DAEMON_ADDRESS: the X-Ray Daemon IP_ADDRESS",":PORT"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"cloudfront-functions--lambdaedge",children:"CloudFront Functions & Lambda@Edge"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Many modern applications execute some form of the logic at the edge"}),"\n",(0,a.jsx)(n.li,{children:"Edge Function: A code that you write and attach to CloudFront distributions and runs close to your users to minimize latency"}),"\n",(0,a.jsx)(n.li,{children:"CloudFront provides two types: CloudFront Functions & Lambda@Edge"}),"\n",(0,a.jsx)(n.li,{children:"You don\u2019t have to manage any servers, deployed globally"}),"\n",(0,a.jsx)(n.li,{children:"Use case: customize the CDN content"}),"\n",(0,a.jsx)(n.li,{children:"Pay only for what you use"}),"\n",(0,a.jsx)(n.li,{children:"Fully serverless"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"cloudfront-functions",children:"CloudFront Functions"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Lightweight functions written in JavaScript"}),"\n",(0,a.jsx)(n.li,{children:"For high-scale, latency-sensitive CDN customizations"}),"\n",(0,a.jsx)(n.li,{children:"Sub-ms startup times, millions of requests/second"}),"\n",(0,a.jsxs)(n.li,{children:["Used to change Viewer requests and responses:","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Viewer Request: after CloudFront receives a request from a viewer"}),"\n",(0,a.jsx)(n.li,{children:"Viewer Response: before CloudFront forwards the response to the viewer"}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.li,{children:"Native feature of CloudFront (manage code entirely within CloudFront)"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"cloudfront-functions",src:i(64237).A+"",width:"402",height:"903"})}),"\n",(0,a.jsx)(n.h3,{id:"lambdaedge",children:"Lambda@Edge"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Lambda functions written in NodeJS or Python"}),"\n",(0,a.jsx)(n.li,{children:"Scales to 1000s of requests/second"}),"\n",(0,a.jsxs)(n.li,{children:["Used to change CloudFront requests and responses:","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Viewer Request \u2013 after CloudFront receives a request from a viewer"}),"\n",(0,a.jsx)(n.li,{children:"Origin Request \u2013 before CloudFront forwards the request to the origin"}),"\n",(0,a.jsx)(n.li,{children:"Origin Response \u2013 after CloudFront receives the response from the origin"}),"\n",(0,a.jsx)(n.li,{children:"Viewer Response \u2013 before CloudFront forwards the response to the viewer"}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.li,{children:"Author your functions in one AWS Region (us-east-1), then CloudFront replicates to its locations"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"lambda-at-edge",src:i(62576).A+"",width:"339",height:"862"})}),"\n",(0,a.jsx)(n.h3,{id:"cloudfront-functions-vs-lambdaedge",children:"CloudFront Functions vs. Lambda@Edge"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"cloudfront-vs-lambda-at-edge",src:i(25149).A+"",width:"1681",height:"729"})}),"\n",(0,a.jsx)(n.h3,{id:"use-cases",children:"Use Cases"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"cloudfront-vs-at-edge",src:i(37253).A+"",width:"1684",height:"699"})}),"\n",(0,a.jsx)(n.h2,{id:"lambda-and-vpcs",children:"Lambda and VPCs"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"By default, your Lambda function is launched outside your own VPC (in an AWS-owned VPC)"}),"\n",(0,a.jsx)(n.li,{children:"Therefore it cannot access resources in your VPC (RDS, ElastiCache, internal ELB\u2026)"}),"\n",(0,a.jsxs)(n.li,{children:["Lambda in a VPC:","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"You must define the VPC ID, the Subnets and the Security Groups"}),"\n",(0,a.jsx)(n.li,{children:"Lambda will create an ENI (Elastic Network Interface) in your subnets"}),"\n",(0,a.jsx)(n.li,{children:"AWSLambdaVPCAccessExecutionRole necessary"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"internet-access",children:"Internet Access"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"A Lambda function in your VPC does not have internet access"}),"\n",(0,a.jsx)(n.li,{children:"Deploying a Lambda function in a public subnet does not give it internet access or a public IP"}),"\n",(0,a.jsx)(n.li,{children:"Deploying a Lambda function in a private subnet gives it internet access if you have a NAT Gateway / Instance"}),"\n",(0,a.jsx)(n.li,{children:"You can use VPC endpoints to privately access AWS services without a NAT"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"lambda-vpc-internet",src:i(96578).A+"",width:"912",height:"901"})}),"\n",(0,a.jsx)(n.h2,{id:"lambda-function-configuration",children:"Lambda Function Configuration"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["RAM:","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"From 128MB to 10GB in 1MB increments"}),"\n",(0,a.jsx)(n.li,{children:"The more RAM you add, the more vCPU credits you get"}),"\n",(0,a.jsx)(n.li,{children:"At 1,792 MB, a function has the equivalent of one full vCPU"}),"\n",(0,a.jsx)(n.li,{children:"After 1,792 MB, you get more than one CPU, and need to use multi-threading in your code to benefit from it (up to 6 vCPU)"}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.li,{children:"If your application is CPU-bound (computation heavy), increase RAM"}),"\n",(0,a.jsx)(n.li,{children:"Timeout: default 3 seconds, maximum is 900 seconds (15 minutes)"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"lambda-execution-context",children:"Lambda Execution Context"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"The execution context is a temporary runtime environment that initializes any external dependencies of your lambda code"}),"\n",(0,a.jsx)(n.li,{children:"Great for database connections, HTTP clients, SDK clients\u2026"}),"\n",(0,a.jsx)(n.li,{children:"The execution context is maintained for some time in anticipation of another Lambda function invocation"}),"\n",(0,a.jsx)(n.li,{children:"The next function invocation can \u201cre-use\u201d the context to execution time and save time in initializing connections objects"}),"\n",(0,a.jsx)(n.li,{children:"The execution context includes the /tmp directory"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"initialize-outside-the-handler",children:"Initialize outside the handler"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"lambda-init",src:i(31297).A+"",width:"1752",height:"622"})}),"\n",(0,a.jsx)(n.h3,{id:"tmp-space",children:"/tmp space"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"If your Lambda function needs to download a big file to work\u2026"}),"\n",(0,a.jsx)(n.li,{children:"If your Lambda function needs disk space to perform operations\u2026"}),"\n",(0,a.jsx)(n.li,{children:"You can use the /tmp directory"}),"\n",(0,a.jsx)(n.li,{children:"Max size is 10GB"}),"\n",(0,a.jsx)(n.li,{children:"The directory content remains when the execution context is frozen, providing transient cache that can be used for multiple invocations (helpful to checkpoint your work)"}),"\n",(0,a.jsx)(n.li,{children:"For permanent persistence of object (non temporary), use S3"}),"\n",(0,a.jsx)(n.li,{children:"To encr ypt content on /tmp, you must generate KMS Data Keys"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"lambda-layers",children:"Lambda Layers"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"lambda-layers",src:i(88497).A+"",width:"1738",height:"783"})}),"\n",(0,a.jsx)(n.h2,{id:"file-systems-mounting",children:"File Systems Mounting"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Lambda functions can access EFS file systems if they are running in a VPC"}),"\n",(0,a.jsx)(n.li,{children:"Configure Lambda to mount EFS file systems to local directory during initialization"}),"\n",(0,a.jsx)(n.li,{children:"Must leverage EFS Access Points"}),"\n",(0,a.jsx)(n.li,{children:"Limitations: watch out for the EFS connection limits (one function instance = one connection) and connection burst limits"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"storage-options",children:"Storage Options"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"lambda-storage",src:i(95124).A+"",width:"1651",height:"798"})}),"\n",(0,a.jsx)(n.h2,{id:"concurrency-and-throttling",children:"Concurrency and Throttling"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Concurrency limit: up to 1000 concurrent executions"}),"\n",(0,a.jsx)(n.li,{children:"Can set a \u201creserved concurrency\u201d at the function level (=limit)"}),"\n",(0,a.jsx)(n.li,{children:"Each invocation over the concurrency limit will trigger a \u201cThrottle\u201d"}),"\n",(0,a.jsxs)(n.li,{children:["Throttle behavior:","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"If synchronous invocation => return ThrottleError - 429"}),"\n",(0,a.jsx)(n.li,{children:"If asynchronous invocation => retry automatically and then go to DLQ"}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.li,{children:"If you need a higher limit, open a support ticket"}),"\n",(0,a.jsx)(n.li,{children:"If you don\u2019t reserve (=limit) concurrency one service e.g. application load balancer can take up all the concurrent executions and other services e.g. API Gateway and SDK/CLI are throttled"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"concurrency-and-asynchronous-invocations",children:"Concurrency and Asynchronous Invocations"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"If the function doesn't have enough concurrency available to process all events, additional requests are throttled."}),"\n",(0,a.jsx)(n.li,{children:"For throttling errors (429) and system errors (500-series), Lambda returns the event to the queue and attempts to run the function again for up to 6 hours."}),"\n",(0,a.jsx)(n.li,{children:"The retry interval increases exponentially from 1 second after the first attempt to a maximum of 5 minutes."}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"cold-starts--provisioned-concurrency",children:"Cold Starts & Provisioned Concurrency"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Cold Start:","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"New instance => code is loaded and code outside the handler run (init)"}),"\n",(0,a.jsx)(n.li,{children:"If the init is large (code, dependencies, SDK\u2026) this process can take some time."}),"\n",(0,a.jsx)(n.li,{children:"First request served by new instances has higher latency than the rest"}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["Provisioned Concurrency:","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Concurrency is allocated before the function is invoked (in advance)"}),"\n",(0,a.jsx)(n.li,{children:"So the cold start never happens and all invocations have low latency"}),"\n",(0,a.jsx)(n.li,{children:"Application Auto Scaling can manage concurrency (schedule or target utilization)"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"reserved-provisioned-concurrency",src:i(40558).A+"",width:"1638",height:"688"})}),"\n",(0,a.jsx)(n.h2,{id:"misc",children:"Misc"}),"\n",(0,a.jsx)(n.h3,{id:"lambda-function-dependencies",children:"Lambda Function Dependencies"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"If your Lambda function depends on external libraries: for example AWS X-Ray SDK, Database Clients, etc\u2026"}),"\n",(0,a.jsxs)(n.li,{children:["You need to install the packages alongside your code and zip it together","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"For Node.js, use npm & \u201cnode_modules\u201d directory"}),"\n",(0,a.jsx)(n.li,{children:"For Python, use pip --target options"}),"\n",(0,a.jsx)(n.li,{children:"For Java, include the relevant .jar files"}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.li,{children:"Upload the zip straight to Lambda if less than 50MB, else to S3 first"}),"\n",(0,a.jsx)(n.li,{children:"Native libraries work: they need to be compiled on Amazon Linux"}),"\n",(0,a.jsx)(n.li,{children:"AWS SDK comes by default with every Lambda function"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"lambda-and-cloudformation--inline",children:"Lambda and CloudFormation \u2013 inline"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Inline functions are very simple"}),"\n",(0,a.jsx)(n.li,{children:"Use the Code.ZipFile property"}),"\n",(0,a.jsx)(n.li,{children:"You cannot include function dependencies with inline functions"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"inline-lambda",src:i(45356).A+"",width:"841",height:"616"})}),"\n",(0,a.jsx)(n.h3,{id:"lambda-and-cloudformation--through-s3",children:"Lambda and CloudFormation \u2013 through S3"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"You must store the Lambda zip in S3"}),"\n",(0,a.jsxs)(n.li,{children:["You must refer the S3 zip location in the CloudFormation code","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"S3Bucket"}),"\n",(0,a.jsx)(n.li,{children:"S3Key: full path to zip"}),"\n",(0,a.jsx)(n.li,{children:"S3ObjectVersion: if versioned bucket"}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.li,{children:"If you update the code in S3, but don\u2019t update S3Bucket, S3Key or S3ObjectVersion, CloudFormation won\u2019t update your function"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Multiple accounts:"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"lambda-s3",src:i(89853).A+"",width:"1695",height:"754"})}),"\n",(0,a.jsx)(n.h2,{id:"lambda-container-images",children:"Lambda Container Images"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Deploy Lambda function as container images of up to 10GB from ECR"}),"\n",(0,a.jsx)(n.li,{children:"Pack complex dependencies, large dependencies in a container"}),"\n",(0,a.jsx)(n.li,{children:"Base images are available for Python, Node.js, Java, .NET, Go, Ruby"}),"\n",(0,a.jsx)(n.li,{children:"Can create your own image as long as it implements the Lambda Runtime API"}),"\n",(0,a.jsx)(n.li,{children:"Test the containers locally using the Lambda Runtime Interface Emulator"}),"\n",(0,a.jsx)(n.li,{children:"Unified workflow to build apps"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"best-practices",children:"Best Practices"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Strategies for optimizing container images:","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Use AWS-provided Base Images","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Stable, Built on Amazon Linux 2, cached by Lambda service"}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["Use Multi-Stage Builds","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Build your code in larger preliminary images, copy only the artifacts you need in your final container image, discard the preliminary steps"}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["Build from Stable to Frequently Changing","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Make your most frequently occurring changes as late in your Dockerfile as possible"}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["Use a Single Repository for Functions with Large Layers","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"ECR compares each layer of a container image when it is pushed to avoid uploading and storing duplicates"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.li,{children:"Use them to upload large Lambda Functions (up to 10 GB)"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"aws-lambda-versions--aliases",children:"AWS Lambda Versions & Aliases"}),"\n",(0,a.jsx)(n.h3,{id:"versions",children:"Versions"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"When you work on a Lambda function, we work on $LATEST"}),"\n",(0,a.jsx)(n.li,{children:"When we\u2019re ready to publish a Lambda function, we create a version"}),"\n",(0,a.jsx)(n.li,{children:"Versions are immutable"}),"\n",(0,a.jsx)(n.li,{children:"Versions have increasing version numbers"}),"\n",(0,a.jsx)(n.li,{children:"Versions get their own ARN (Amazon Resource Name)"}),"\n",(0,a.jsx)(n.li,{children:"Version = code + configuration (nothing can be changed - immutable)"}),"\n",(0,a.jsx)(n.li,{children:"Each version of the lambda function can be accessed"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"aliases",children:"Aliases"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Aliases are \u201dpointers\u201d to Lambda function versions"}),"\n",(0,a.jsx)(n.li,{children:"We can define a \u201cdev\u201d, \u201dtest\u201d, \u201cprod\u201d aliases and have them point at different lambda versions"}),"\n",(0,a.jsx)(n.li,{children:"Aliases are mutable"}),"\n",(0,a.jsx)(n.li,{children:"Aliases enable Canary deployment by assigning weights to lambda functions"}),"\n",(0,a.jsx)(n.li,{children:"Aliases enable stable configuration of our event triggers / destinations"}),"\n",(0,a.jsx)(n.li,{children:"Aliases have their own ARNs"}),"\n",(0,a.jsx)(n.li,{children:"Aliases cannot reference aliases"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"lambda--codedeploy",children:"Lambda & CodeDeploy"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"CodeDeploy can help you automate traffic shift for Lambda aliases"}),"\n",(0,a.jsx)(n.li,{children:"Feature is integrated within the SAM framework"}),"\n",(0,a.jsxs)(n.li,{children:["Linear: grow traffic every N minutes until 100%","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Linear10PercentEvery3Minutes"}),"\n",(0,a.jsx)(n.li,{children:"Linear10PercentEvery10Minutes"}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["Canary: try X percent then 100%","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Canary10Percent5Minutes"}),"\n",(0,a.jsx)(n.li,{children:"Canary10Percent30Minutes"}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.li,{children:"AllAtOnce: immediate"}),"\n",(0,a.jsx)(n.li,{children:"Can create Pre & Post Traffic hooks to check the health of the Lambda function"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"appspecyml",children:"AppSpec.yml"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Name (required) \u2013 the name of the Lambda function to deploy"}),"\n",(0,a.jsx)(n.li,{children:"Alias (required) \u2013 the name of the alias to the Lambda function"}),"\n",(0,a.jsx)(n.li,{children:"CurrentVersion (required) \u2013 the version of the Lambda function traffic currently points to"}),"\n",(0,a.jsx)(n.li,{children:"TargetVersion (required) \u2013 the version of the Lambda function traffic is shifted to"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"function-url",children:"Function URL"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Dedicated HTTP(S) endpoint for your Lambda function"}),"\n",(0,a.jsx)(n.li,{children:"A unique URL endpoint is generated for you (never changes)"}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"https://<url-id>.lambda-url.<region>.on.aws"})," (dual-stack IPv4 & IPv6)"]}),"\n",(0,a.jsx)(n.li,{children:"Invoke via a web browser, curl, Postman, or any HTTP client"}),"\n",(0,a.jsx)(n.li,{children:"Access your function URL through the public Internet only"}),"\n",(0,a.jsx)(n.li,{children:"Doesn\u2019t support PrivateLink (Lambda functions do support)"}),"\n",(0,a.jsx)(n.li,{children:"Supports Resource-based Policies & CORS configurations"}),"\n",(0,a.jsx)(n.li,{children:"Can be applied to any function alias or to $LATEST (can\u2019t be applied to other function versions)"}),"\n",(0,a.jsx)(n.li,{children:"Create and configure using AWS Console or AWS API"}),"\n",(0,a.jsx)(n.li,{children:"Throttle your function by using Reserved Concurrency"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"security",children:"Security"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Resource-based Policy","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Authorize other accounts / specific CIDR / IAM principals"}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["Cross-Origin Resource Sharing (CORS)","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"If you call your Lambda function URL from a different domain"}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["AuthType NONE \u2013 allow public and unauthenticated access","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Resource-based Policy is always in effect (must grant public access)"}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["AuthType AWS_IAM \u2013 IAM is used to authenticate and authorize requests","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Both Principal\u2019s Identity-based Policy & Resource-based Policy are evaluated"}),"\n",(0,a.jsxs)(n.li,{children:["Principal must have lambda",":InvokeFunctionUrl"," permissions"]}),"\n",(0,a.jsx)(n.li,{children:"Same account \u2013 Identity-based Policy OR Resource-based Policy as ALLOW"}),"\n",(0,a.jsx)(n.li,{children:"Cross account \u2013 Identity-based Policy AND Resource Based Policy as ALLOW"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"lambda-and-codeguru-profiling",children:"Lambda and CodeGuru Profiling"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Gain insights into runtime performance of your Lambda functions using CodeGuru Profiler"}),"\n",(0,a.jsx)(n.li,{children:"CodeGuru creates a Profiler Group for your Lambda function"}),"\n",(0,a.jsx)(n.li,{children:"Supported for Java and Python runtimes"}),"\n",(0,a.jsx)(n.li,{children:"Activate from AWS Lambda Console"}),"\n",(0,a.jsxs)(n.li,{children:["When activated, Lambda adds:","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"CodeGuru Profiler layer to your function"}),"\n",(0,a.jsx)(n.li,{children:"Environment variables to your function"}),"\n",(0,a.jsx)(n.li,{children:"AmazonCodeGuruProfilerAgentAccess policy to your function"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"lambda-limits-to-know---per-region",children:"Lambda Limits to Know - per region"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Execution:","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Memory allocation: 128 MB \u2013 10GB (1 MB increments)"}),"\n",(0,a.jsx)(n.li,{children:"Maximum execution time: 900 seconds (15 minutes)"}),"\n",(0,a.jsx)(n.li,{children:"Environment variables (4 KB)"}),"\n",(0,a.jsx)(n.li,{children:"Disk capacity in the \u201cfunction container\u201d (in /tmp): 512 MB to 10GB"}),"\n",(0,a.jsx)(n.li,{children:"Concurrency executions: 1000 (can be increased)"}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["Deployment:","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Lambda function deployment size (compressed .zip): 50 MB"}),"\n",(0,a.jsx)(n.li,{children:"Size of uncompressed deployment (code + dependencies): 250 MB"}),"\n",(0,a.jsx)(n.li,{children:"Can use the /tmp directory to load other files at startup"}),"\n",(0,a.jsx)(n.li,{children:"Size of environment variables: 4 KB"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"aws-lambda-best-practices",children:"AWS Lambda Best Practices"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Perform heavy-duty work outside of your function handler","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Connect to databases outside of your function handler"}),"\n",(0,a.jsx)(n.li,{children:"Initialize the AWS SDK outside of your function handler"}),"\n",(0,a.jsx)(n.li,{children:"Pull in dependencies or datasets outside of your function handler"}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["Use environment variables for:","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Database Connection Strings, S3 bucket, etc\u2026 don\u2019t put these values in your code"}),"\n",(0,a.jsx)(n.li,{children:"Passwords, sensitive values\u2026 they can be encrypted using KMS"}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["Minimize your deployment package size to its runtime necessities.","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Break down the function if need be"}),"\n",(0,a.jsx)(n.li,{children:"Remember the AWS Lambda limits"}),"\n",(0,a.jsx)(n.li,{children:"Use Layers where necessary"}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.li,{children:"Avoid using recursive code, never have a Lambda function call itself"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},66463:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/alb-lambda-permissions-4e79523bafe573cd204950c28429ec0d.png"},74264:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/alb-to-lambda-2e6a95b93593b71ccce3f61485d30ff2.png"},64237:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/cloudfront-functions-45c7adbc3baa3b853bd1b77a2e04a231.png"},37253:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/cloudfront-vs-at-edge-f9b97294528fd0d5f03f76229de73586.png"},25149:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/cloudfront-vs-lambda-at-edge-37d80c71dd989475b382a88bd42f8241.png"},13051:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/cloudwatch-events-daca11d05b8c123e64683b3226db3a18.png"},45356:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/inline-lambda-eda9082cc4ffe26aad00e2aec3c81f6f.png"},37483:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/lambda-async-3bc61fe5ad42424eb27c11cb0c10ab0a.png"},62576:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/lambda-at-edge-e79210d6448611f0bb8a6d2f3e6e0dcc.png"},20156:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/lambda-destinations-c8674bedaa4063ddd1b193b5a16c5c13.png"},40997:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/lambda-event-context-98deaa5975b26c9e8795f22fd5c5c73a.png"},40908:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/lambda-event-notifications-46a0a42fc554e205a1c906e2a1b28e90.png"},64713:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/lambda-event-source-3fb2157ec6242339d9ab0f6a10ab8fdb.png"},31297:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/lambda-init-06ee739ffa6e2ac68d58ae748652a9c3.png"},88497:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/lambda-layers-66434b9722204bab771e8251cabf16b7.png"},89853:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/lambda-s3-4fe749d95b90dfed39b3ea797e646b1d.png"},25316:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/lambda-simple-example-a87f05ff9a02de316a5ba3eb08946748.png"},95124:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/lambda-storage-f6d69f72872a6e2571d8cbb522bb25b4.png"},43298:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/lambda-synchronous-invocations-fd5153672acd7882a587599552418ee3.png"},96578:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/lambda-vpc-internet-571e1ff8cee1393f953d57695273325c.png"},40558:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/reserved-provisioned-concurrency-7eb2e7277cfa7b38c77adb95f5e4435b.png"},72071:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/sqs-sqs-fifo-e4980bd6230d708f86c575101ba3a604.png"},75616:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/streams-lambda-905f444d5d32fb038fd7ea566d49edc4.png"},28453:(e,n,i)=>{i.d(n,{R:()=>t,x:()=>r});var s=i(96540);const a={},l=s.createContext(a);function t(e){const n=s.useContext(l);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:t(e.components),s.createElement(l.Provider,{value:n},e.children)}}}]);