<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.4">
<title data-react-helmet="true">Resiliency | Learning Collection Knowledge Base</title><meta data-react-helmet="true" property="og:url" content="https://RobinTTY.github.io/LearningCollection/Databases/MongoDB/M220N MongoDB for .NET Developers/resiliency"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Resiliency | Learning Collection Knowledge Base"><meta data-react-helmet="true" name="description" content="Connection pooling"><meta data-react-helmet="true" property="og:description" content="Connection pooling"><link data-react-helmet="true" rel="shortcut icon" href="/LearningCollection/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://RobinTTY.github.io/LearningCollection/Databases/MongoDB/M220N MongoDB for .NET Developers/resiliency"><link data-react-helmet="true" rel="alternate" href="https://RobinTTY.github.io/LearningCollection/Databases/MongoDB/M220N MongoDB for .NET Developers/resiliency" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://RobinTTY.github.io/LearningCollection/Databases/MongoDB/M220N MongoDB for .NET Developers/resiliency" hreflang="x-default"><link rel="stylesheet" href="/LearningCollection/assets/css/styles.bd168e87.css">
<link rel="preload" href="/LearningCollection/assets/js/runtime~main.12ecaeb5.js" as="script">
<link rel="preload" href="/LearningCollection/assets/js/main.da734d84.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/LearningCollection/"><img src="/LearningCollection/img/logo.svg" alt="My Site Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/LearningCollection/img/logo.svg" alt="My Site Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Learning Collection</b></a><a class="navbar__item navbar__link navbar__link--active" href="/LearningCollection/">Docs</a></div><div class="navbar__items navbar__items--right"><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button" title="Scroll to top"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">C-Sharp</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Databases</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">MongoDB</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">M001 MongoDB Basics</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">M220N MongoDB for .NET Developers</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/LearningCollection/Databases/MongoDB/M220N MongoDB for .NET Developers/m220n">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/LearningCollection/Databases/MongoDB/M220N MongoDB for .NET Developers/gettingStarted">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/LearningCollection/Databases/MongoDB/M220N MongoDB for .NET Developers/usingTheDriver">Using the Driver</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/LearningCollection/Databases/MongoDB/M220N MongoDB for .NET Developers/userFacingBackend">User-Facing Backend</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/LearningCollection/Databases/MongoDB/M220N MongoDB for .NET Developers/adminBackend">Admin Backend</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/LearningCollection/Databases/MongoDB/M220N MongoDB for .NET Developers/resiliency">Resiliency</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/LearningCollection/Databases/MongoDB/M220N MongoDB for .NET Developers/notesOnMongoDB">Notes on MongoDB</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/LearningCollection/Databases/MongoDB/mongoShellCommands">Important Mongo Shell Commands</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">General Concepts</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Tools</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Web</a></li><li class="menu__list-item"><a class="menu__link" href="/LearningCollection/">Introduction</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="markdown"><header><h1 class="h1Heading_27L5">Resiliency</h1></header><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="connection-pooling"></a>Connection pooling<a class="hash-link" href="#connection-pooling" title="Direct link to heading">#</a></h2><ul><li>A way of reusing database connections</li><li>Creating a connection to the database requires time and computing resources</li><li>Connection Pooling helps reduce the overhead of creating database connections</li><li>By default the driver will create a pool of 100 connections to share</li><li>Subsequent requests appear faster to the client</li></ul><p><img alt="connection pool" src="/LearningCollection/assets/images/connectionPool-8caa20728134a848beb11974938109a2.PNG"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="example"></a>Example<a class="hash-link" href="#example" title="Direct link to heading">#</a></h3><p>Defined in the connection string:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly txt"><pre tabindex="0" class="prism-code language-txt codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">mongodb+srv://user:password@server.net?maxPoolSize=50</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>For more options see: <a href="https://docs.mongodb.com/manual/reference/connection-string/" target="_blank" rel="noopener noreferrer">MongoDB Docs</a></p><p>Defined in code:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly C#"><pre tabindex="0" class="prism-code language-C# codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">_client = new MongoClient(new MongoClientSettings(){ MaxConnectionPoolSize = 50});</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="write-timeouts"></a>Write timeouts<a class="hash-link" href="#write-timeouts" title="Direct link to heading">#</a></h2><ul><li>We should always expect application external resources like queues, networks and databases to take more time than expected</li><li>We can configure a write timeout to handle theses instances appropriately</li><li>Especially when we use the WriteConcern &quot;majority&quot; we should always configure an appropriate timeout</li><li><strong>By default</strong>, when using Write Concern more durable than w: 1, <strong>there is no wtimeout</strong>, so <strong>the server will wait indefinitely</strong> for operations to complete</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="example-1"></a>Example<a class="hash-link" href="#example-1" title="Direct link to heading">#</a></h3><p>Defined in the connection string:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly txt"><pre tabindex="0" class="prism-code language-txt codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">mongodb+srv://user:password@server.net?wtimeoutMS=2500</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Defined in code:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly C#"><pre tabindex="0" class="prism-code language-C# codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">_client = new MongoClient(Constants.MongoDbConnectionUriWithMaxPoolSize).WithWriteConcern(</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                new WriteConcern(wTimeout: TimeSpan.FromMilliseconds(2500))) as MongoClient;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="serverselectiontimeout"></a>ServerSelectionTimeout<a class="hash-link" href="#serverselectiontimeout" title="Direct link to heading">#</a></h2><ul><li>It is important to always handle the ServerSelectionTimeout</li><li>By handling the error we can also passively monitor the health of our application stack</li><li>E.g. if a database server goes down we can identify what happened through handling the error</li><li>By default the driver waits 30 seconds before raising a ServerSelectionTimeout exception but this time can be changed</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="example-2"></a>Example<a class="hash-link" href="#example-2" title="Direct link to heading">#</a></h3><p>Defined in the connection string:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly txt"><pre tabindex="0" class="prism-code language-txt codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">mongodb+srv://user:password@server.net?serverSelectionTimeoutMS=5000</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Defined in code:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly C#"><pre tabindex="0" class="prism-code language-C# codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">_client = new MongoClient(new MongoClientSettings(){ ServerSelectionTimeout = TimeSpan.FromMilliseconds(5000)});</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="principle-of-least-privilege"></a>Principle of Least Privilege<a class="hash-link" href="#principle-of-least-privilege" title="Direct link to heading">#</a></h2><blockquote><p>Every program and every privileged user of the system should operate using the least amount of privilege necessary to complete the job.</p></blockquote><p>Jerome Saltzer, Communications of the ACM</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="user-management-at-the-database-level"></a>User management at the database level<a class="hash-link" href="#user-management-at-the-database-level" title="Direct link to heading">#</a></h3><ul><li>MongoDB offers user management at the database level</li><li>by creating a database user specifically for the application, we can in a more granular way select the privileges and resources that mFlix should have access to</li><li>this kind of forces us to ask the question, should the application be able to create indexes or create new collections, or should the application be able to drop an entire database?</li><li>very important in order to prevent the application from accessing a resource that it should never need</li><li><strong>If the application has permission to use an important collection that it&#x27;s not programmed to ever use, than that permission exists only as a vulnerability in our application, and we should remove it</strong></li></ul><p>More resources on security within MongoDB see: <a href="https://university.mongodb.com/courses/M310/about" target="_blank" rel="noopener noreferrer">MongoDB University</a>.</p><p>Course was retired to push Atlas... ðŸ™„<br>
See <a href="https://docs.mongodb.com/manual/security/" target="_blank" rel="noopener noreferrer">Documentation</a> instead.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="summary"></a>Summary<a class="hash-link" href="#summary" title="Direct link to heading">#</a></h2><ul><li>Always use connection pooling</li><li>Always specify a wtimeout with majority writes (or even a write concern more durable than &quot;1&quot;)</li><li>Always handle serverSelectionTimeout errors</li><li>Always handle errors like with any C# application</li><li>Engineer systems with the principle of least privilege in mind</li></ul></div><footer class="row docusaurus-mt-lg"><div class="col"><a href="https://github.com/RobinTTY/LearningCollection/tree/master/website/docs/Databases/MongoDB/M220N MongoDB for .NET Developers/Resiliency.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_3DPF"></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/LearningCollection/Databases/MongoDB/M220N MongoDB for .NET Developers/adminBackend"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Admin Backend</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/LearningCollection/Databases/MongoDB/M220N MongoDB for .NET Developers/notesOnMongoDB"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Notes on MongoDB Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#connection-pooling" class="table-of-contents__link">Connection pooling</a><ul><li><a href="#example" class="table-of-contents__link">Example</a></li></ul></li><li><a href="#write-timeouts" class="table-of-contents__link">Write timeouts</a><ul><li><a href="#example-1" class="table-of-contents__link">Example</a></li></ul></li><li><a href="#serverselectiontimeout" class="table-of-contents__link">ServerSelectionTimeout</a><ul><li><a href="#example-2" class="table-of-contents__link">Example</a></li></ul></li><li><a href="#principle-of-least-privilege" class="table-of-contents__link">Principle of Least Privilege</a><ul><li><a href="#user-management-at-the-database-level" class="table-of-contents__link">User management at the database level</a></li></ul></li><li><a href="#summary" class="table-of-contents__link">Summary</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">My other sites</div><ul class="footer__items"><li class="footer__item"><a href="https://robintty.github.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Website<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Socials</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/RobinTTY" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.linkedin.com/in/robin-m%C3%BCller-574782170/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 Robin MÃ¼ller. Built with Docusaurus.</div></div></div></footer></div>
<script src="/LearningCollection/assets/js/runtime~main.12ecaeb5.js"></script>
<script src="/LearningCollection/assets/js/main.da734d84.js"></script>
</body>
</html>