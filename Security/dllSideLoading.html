<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-Security/dllSideLoading">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.18">
<title data-rh="true">DLL Side-Loading | Learning Collection Knowledge Base</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://RobinTTY.github.io/LearningCollection/Security/dllSideLoading"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="DLL Side-Loading | Learning Collection Knowledge Base"><meta data-rh="true" name="description" content="- Category: Defense Evasion"><meta data-rh="true" property="og:description" content="- Category: Defense Evasion"><link data-rh="true" rel="icon" href="/LearningCollection/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://RobinTTY.github.io/LearningCollection/Security/dllSideLoading"><link data-rh="true" rel="alternate" href="https://RobinTTY.github.io/LearningCollection/Security/dllSideLoading" hreflang="en"><link data-rh="true" rel="alternate" href="https://RobinTTY.github.io/LearningCollection/Security/dllSideLoading" hreflang="x-default"><link rel="stylesheet" href="/LearningCollection/assets/css/styles.ec9ba7f9.css">
<link rel="preload" href="/LearningCollection/assets/js/runtime~main.896562ce.js" as="script">
<link rel="preload" href="/LearningCollection/assets/js/main.027d0109.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/LearningCollection/"><div class="navbar__logo"><img src="/LearningCollection/img/logo.svg" alt="My Site Logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/LearningCollection/img/logo.svg" alt="My Site Logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">Learning Collection</b></a><a class="navbar__item navbar__link navbar__link--active" href="/LearningCollection/">Docs</a></div><div class="navbar__items navbar__items--right"><div class="toggle_S7eR colorModeToggle_vKtC"><button class="clean-btn toggleButton_rCf9 toggleButtonDisabled_Pu9x" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_RiAD"><nav class="menu thin-scrollbar menu_izAj"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/LearningCollection/">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/LearningCollection/General Concepts/callStack">General Concepts</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/LearningCollection/C-Sharp/Core Concepts/Types/recordTypes">C-Sharp</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/LearningCollection/Web/HTML/doctype">Web</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/LearningCollection/Databases/MongoDB/authentication">Databases</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/LearningCollection/Tools/antlr">Tools</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/LearningCollection/Linux/commonlyUsedCommands">Linux</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/LearningCollection/Security/dataObfuscation">Security</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/LearningCollection/Security/dataObfuscation">Data Obfuscation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/LearningCollection/Security/trustedDeveloperUtilities">Trusted Developer Utilities Proxy Execution</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/LearningCollection/Security/dllSideLoading">DLL Side-Loading</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/LearningCollection/Security/Kali Linux/Metasploit">Kali Linux</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/LearningCollection/Interesting Topics/interestingTopics">Interesting Topics</a></div></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/LearningCollection/">üè†</a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><span class="breadcrumbs__link" itemprop="item name">Security</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="item name">DLL Side-Loading</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>DLL Side-Loading</h1></header><ul><li>Category: Defense Evasion</li><li>Technique: Hijack Execution Flow</li><li>Goal: Execute malicious payload</li></ul><p>References:</p><ul><li>MITRE: <a href="https://attack.mitre.org/techniques/T1574/002/" target="_blank" rel="noopener noreferrer">Hijack Execution Flow: DLL Side-Loading</a></li><li>FireEye: <a href="https://www.mandiant.com/media/10376/download" target="_blank" rel="noopener noreferrer">DLL SIDE-LOADING: A THORN IN THE SIDE OF THE ANTI-VIRUS INDUSTRY - 2014</a></li></ul><p>DLL Side-Loading involves execution of a malicious payload in form of a DLL. Rather than just planting the DLL within the search order of a program (to await invocation by a user process) the adversaries may directly side-load the payload by invoking a legitimate application that executes the payload.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="traditional-dll-side-loading-on-windows">Traditional DLL-Side loading on Windows<a class="hash-link" href="#traditional-dll-side-loading-on-windows" title="Direct link to heading">‚Äã</a></h2><ul><li>Windows, like many operating systems, allows applications to load DLLs at runtime</li><li>Applications can specify the location of DLLs by specifying a full path, using DLL redirection, or by using a manifest.</li><li>If none of these methods are used, Windows attempts to locate the DLL by searching a <strong>predefined set of directories</strong> in a set order</li><li>This fact can be abused by placing a malicious DLL in one of these directories<ul><li>In these cases Windows reaches the malicious DLL before finding the legitimate version</li></ul></li></ul><p>Side-loading <strong>takes advantage of the DLL search order</strong> used by the loader by positioning both the victim application and malicious payload(s) alongside each other. Executables used to side-load payloads may not be flagged during delivery and/or execution which makes them a good way to evade detection.</p><p>The payload itself may also be encrypted/packed or otherwise obfuscated until loaded into memory of the trusted process.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="examples-of-dll-side-loading">Examples of DLL Side-Loading<a class="hash-link" href="#examples-of-dll-side-loading" title="Direct link to heading">‚Äã</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="operation-clandestine-fox">Operation Clandestine Fox<a class="hash-link" href="#operation-clandestine-fox" title="Direct link to heading">‚Äã</a></h3><ul><li>Attack originating from APT3, a China-based group which researchers have attributed to China&#x27;s Ministry of State Security</li><li>Attack was carried out in 2014</li><li>Target were companies in the energy sector</li></ul><h4 class="anchor anchorWithStickyNavbar_mojV" id="initial-contact">Initial Contact<a class="hash-link" href="#initial-contact" title="Direct link to heading">‚Äã</a></h4><ul><li>The initial attack vector is social engineering: An e-mail is sent which is made to look like a job application</li><li>The e-mail contains an attachment with a resume and <strong>sample software</strong> the applicant has written</li><li>The applicant had previously contacted the employee who received the e-mail via a social network, to make it look more legitimate</li><li>Before the e-mail was sent, there had been three weeks of communication between applicant and employee</li></ul><p>The email contained the following:</p><blockquote><p>Hi Michael,</p><p>Attached is my resume and the software I developed for my Uncle who is a researcher in new material. Last week I was busy with my partners to develop a control system. Thank you very much. Wish to be a member of your company.</p><p>Emily</p></blockquote><ul><li>FireEye investigated this attack and found some inconsistencies in the social profile of the alleged applicant:<ul><li>She had some fake education history</li><li>She also had additional contacts at the victim&#x27;s company</li><li>She had inquired about who the IT Manger was and what versions of software they ran with her other contacts</li></ul></li></ul><p>The attacker used e-mail and social networks to communicate with her various contacts. Worth noting is that the attacker used the private e-mail addresses of employees to contact them, possibly to circumvent the more sophisticated corporate e-mail security but maybe just because employees had linked their personal e-mail to the social network instead of the work address.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-e-mail-attachments">The E-Mail Attachments<a class="hash-link" href="#the-e-mail-attachments" title="Direct link to heading">‚Äã</a></h4><p>Attached to the E-Mail was a single <strong>&quot;resume.rar&quot;</strong> file. This archive was sent to different companies and didn&#x27;t always contain the same files. The archive with the sideloading attack looked as follows:</p><ul><li>SETUP.exe</li><li>my resume.pdf</li></ul><p>This archive was protected by the password &quot;TTcalc&quot;.</p><p><strong>SETUP.exe</strong> is a self executing RAR archive containting more files:</p><ul><li>ttcalc.exe</li><li>ttcalcBAK.exe</li><li>ttcalc.chm</li><li>README</li><li>CHANGELOG</li><li>COPYRIGHT</li></ul><p>When the SETUP.exe is executed it opens the WinRAR window, prompting the user for the location to extract the files to.</p><p>The files are written to a TTCalc folder and it is tried to launch ttcalcBAK.exe (the malware dropper) but the path is incorrect so it fails with an error message. All other files are benign and related to the legitimate TTCalc application.</p><p>TTCalc is a scientific calculator.</p><p>ttcalcBAK.exe is also a self-extracting RAR which drops and launches <em>chrome_frame_helper</em>. Chrome frame helper dll is a file that belongs to Google Chrome Frame, a plugin for Internet Explorer that enables Internet Explorer to display web pages in Google Chrome&#x27;s rendering style. The project was retired in 2014.</p><p>In this case the file is a <a href="https://www.fireeye.com/blog/threat-research/2014/07/pacific-ring-of-fire-plugx-kaba.html" target="_blank" rel="noopener noreferrer">Backdoor</a>, it uses a legitimate Chrome executable to <strong>load the malicious DLL via side-loading</strong>. According to FireEye this kind of malware was quiet common at the time (2014).</p><p>Now with the actual malcode loaded the malware would start to communicate with the Command and Control Server.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="what-we-can-learn">What we can learn<a class="hash-link" href="#what-we-can-learn" title="Direct link to heading">‚Äã</a></h2><ul><li>Very often the attack vector is social engineering and if we are more cautious about these interactions we can avoid possible attacks</li><li>Don&#x27;t use your personal Mail for business communication purposes</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="mitigations">Mitigations<a class="hash-link" href="#mitigations" title="Direct link to heading">‚Äã</a></h2><ul><li>Train developers of applications so they know how to avoid introducing DLL Side-Loading vulnerabilities</li><li>Train users of applications that might be vulnerable to DLL Side-Loading attacks</li><li>Restrict possibly abused functionality in applications if possible (e.g. Excel/Word Macros, etc.)</li><li>Keep software up to date</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="detection">Detection<a class="hash-link" href="#detection" title="Direct link to heading">‚Äã</a></h2><ul><li>Monitor running processes on your machine for unusual activity<ul><li>e.g. a process that does not usually use the network begins to do so</li></ul></li><li>Monitor the introduction of new files/programs</li><li>Track DLL metadata<ul><li>e.g. compute a hash of the DLL and validate it before loading it for process execution (you need to account for updates/patching)</li></ul></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/RobinTTY/LearningCollection/tree/master/website/docs/Security/DLL Side-Loading.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/LearningCollection/Security/trustedDeveloperUtilities"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Trusted Developer Utilities Proxy Execution</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/LearningCollection/Security/Kali Linux/Metasploit"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Metasploit</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#traditional-dll-side-loading-on-windows" class="table-of-contents__link toc-highlight">Traditional DLL-Side loading on Windows</a></li><li><a href="#examples-of-dll-side-loading" class="table-of-contents__link toc-highlight">Examples of DLL Side-Loading</a><ul><li><a href="#operation-clandestine-fox" class="table-of-contents__link toc-highlight">Operation Clandestine Fox</a></li></ul></li><li><a href="#what-we-can-learn" class="table-of-contents__link toc-highlight">What we can learn</a></li><li><a href="#mitigations" class="table-of-contents__link toc-highlight">Mitigations</a></li><li><a href="#detection" class="table-of-contents__link toc-highlight">Detection</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">My other sites</div><ul class="footer__items"><li class="footer__item"><a href="https://robintty.github.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Website<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Socials</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/RobinTTY" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.linkedin.com/in/robin-m%C3%BCller-574782170/" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2022 Robin M√ºller. Built with Docusaurus.</div></div></div></footer></div>
<script src="/LearningCollection/assets/js/runtime~main.896562ce.js"></script>
<script src="/LearningCollection/assets/js/main.027d0109.js"></script>
</body>
</html>